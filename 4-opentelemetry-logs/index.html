
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../3-codespaces/">
      
      
        <link rel="next" href="../5-opentelemetry-capstone/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.42">
    
    
      
        <title>4. OpenTelemetry Logs - Dynatrace Enablement Lab: OpenTelemetry Logs and OpenPipeline</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
  <!-- Add scripts that need to run before here -->
  
      
    
  <!-- Add scripts that need to run afterwards here
    WebApp
    https://hci34192.apps.dynatrace.com/ui/apps/dynatrace.classic.frontend/#uemapplications/uemappmetrics;uemapplicationId=APPLICATION-18597139D3817440;gtf=-2h;gf=all
    -->
    <script type="text/javascript" src="https://js-cdn.dynatrace.com/jstag/145e12d594f/bf64904yne/18597139d3817440_complete.js" crossorigin="anonymous"></script>

    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#opentelemetry-logs" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Dynatrace Enablement Lab: OpenTelemetry Logs and OpenPipeline" class="md-header__button md-logo" aria-label="Dynatrace Enablement Lab: OpenTelemetry Logs and OpenPipeline" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Dynatrace Enablement Lab: OpenTelemetry Logs and OpenPipeline
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              4. OpenTelemetry Logs
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/dynatrace-wwse/enablement-kubernetes-opentelemetry-openpipeline" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    View Code on GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Dynatrace Enablement Lab: OpenTelemetry Logs and OpenPipeline" class="md-nav__button md-logo" aria-label="Dynatrace Enablement Lab: OpenTelemetry Logs and OpenPipeline" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Dynatrace Enablement Lab: OpenTelemetry Logs and OpenPipeline
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/dynatrace-wwse/enablement-kubernetes-opentelemetry-openpipeline" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    View Code on GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. About
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../2-getting-started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Getting started
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../3-codespaces/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Codespaces
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    4. OpenTelemetry Logs
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    4. OpenTelemetry Logs
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#opentelemetry-operator" class="md-nav__link">
    <span class="md-ellipsis">
      OpenTelemetry Operator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#opentelemetry-collector-for-logs" class="md-nav__link">
    <span class="md-ellipsis">
      OpenTelemetry Collector for Logs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OpenTelemetry Collector for Logs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#filelog-receiver" class="md-nav__link">
    <span class="md-ellipsis">
      filelog Receiver
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k8sattributes-processor" class="md-nav__link">
    <span class="md-ellipsis">
      k8sattributes Processor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resourcedetection-processor" class="md-nav__link">
    <span class="md-ellipsis">
      resourcedetection Processor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-processor" class="md-nav__link">
    <span class="md-ellipsis">
      resource Processor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#export-to-otlp-receiver" class="md-nav__link">
    <span class="md-ellipsis">
      Export to OTLP Receiver
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-astronomy-shop-via-helm" class="md-nav__link">
    <span class="md-ellipsis">
      Update Astronomy Shop via Helm
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#opentelemetry-collector-for-events" class="md-nav__link">
    <span class="md-ellipsis">
      OpenTelemetry Collector for Events
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OpenTelemetry Collector for Events">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#k8sobjects-receiver" class="md-nav__link">
    <span class="md-ellipsis">
      k8sobjects Receiver
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-opentelemetry-collector-gateway" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy OpenTelemetry Collector (Gateway)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-events" class="md-nav__link">
    <span class="md-ellipsis">
      Generate Events
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wrap-up" class="md-nav__link">
    <span class="md-ellipsis">
      Wrap Up
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#continue" class="md-nav__link">
    <span class="md-ellipsis">
      Continue
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../5-opentelemetry-capstone/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. OpenTelemetry Capstone
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../6-dynatrace-buckets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. Dynatrace Buckets
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../7-dynatrace-openpipeline-collector-logs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7. Dynatrace OpenPipeline Collector Logs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../8-dynatrace-openpipeline-astronomy-shop-logs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8. Dynatrace OpenPipeline Astronomy Shop Logs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../9-dynatrace-openpipeline-kubernetes-events/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9. Dynatrace OpenPipeline Kubernetes Events
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cleanup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    10. Cleanup
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#opentelemetry-operator" class="md-nav__link">
    <span class="md-ellipsis">
      OpenTelemetry Operator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#opentelemetry-collector-for-logs" class="md-nav__link">
    <span class="md-ellipsis">
      OpenTelemetry Collector for Logs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OpenTelemetry Collector for Logs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#filelog-receiver" class="md-nav__link">
    <span class="md-ellipsis">
      filelog Receiver
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k8sattributes-processor" class="md-nav__link">
    <span class="md-ellipsis">
      k8sattributes Processor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resourcedetection-processor" class="md-nav__link">
    <span class="md-ellipsis">
      resourcedetection Processor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-processor" class="md-nav__link">
    <span class="md-ellipsis">
      resource Processor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#export-to-otlp-receiver" class="md-nav__link">
    <span class="md-ellipsis">
      Export to OTLP Receiver
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-astronomy-shop-via-helm" class="md-nav__link">
    <span class="md-ellipsis">
      Update Astronomy Shop via Helm
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#opentelemetry-collector-for-events" class="md-nav__link">
    <span class="md-ellipsis">
      OpenTelemetry Collector for Events
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OpenTelemetry Collector for Events">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#k8sobjects-receiver" class="md-nav__link">
    <span class="md-ellipsis">
      k8sobjects Receiver
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-opentelemetry-collector-gateway" class="md-nav__link">
    <span class="md-ellipsis">
      Deploy OpenTelemetry Collector (Gateway)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate-events" class="md-nav__link">
    <span class="md-ellipsis">
      Generate Events
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wrap-up" class="md-nav__link">
    <span class="md-ellipsis">
      Wrap Up
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#continue" class="md-nav__link">
    <span class="md-ellipsis">
      Continue
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="opentelemetry-logs">OpenTelemetry Logs<a class="headerlink" href="#opentelemetry-logs" title="Permanent link">#</a></h1>
<p>In this module we'll utilize the OpenTelemetry Collector deployed as a DaemonSet (Node Agent) to collect pod/container logs from a Kubernetes cluster and ship them to Dynatrace.  Additionally, we'll deploy the OpenTelemetry Collector as a Deployment (Gateway) to watch Kubernetes Events from the Cluster and ship them to Dynatrace.</p>
<p><strong>Goals:</strong></p>
<ol>
<li>Deploy OpenTelemetry Collector as a DaemonSet</li>
<li>Deploy OpenTelemetry Collector as a Deployment</li>
<li>Configure OpenTelemetry Collector service pipeline for log enrichment</li>
<li>Query and visualize logs in Dynatrace using DQL</li>
</ol>
<p><img alt="astronomy-shop logs" src="../img/logs-astronomy-shop_logs.png" /></p>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">#</a></h2>
<p><strong>Import Notebook into Dynatrace</strong></p>
<p><a href="https://github.com/popecruzdt/enablement-kubernetes-opentelemetry-openpipeline/blob/main/assets/dynatrace/notebooks/opentelemetry-logs_dt_notebook.json" target="_blank">Download Notebook</a></p>
<p>Define workshop user variables</p>
<p>In your Github Codespaces Terminal:
<div class="highlight"><pre><span></span><code>export DT_ENDPOINT=https://{your-environment-id}.live.dynatrace.com/api/v2/otlp
export DT_API_TOKEN={your-api-token}
export NAME=&lt;INITIALS&gt;-k8s-otel-o11y
</code></pre></div></p>
<h2 id="opentelemetry-operator">OpenTelemetry Operator<a class="headerlink" href="#opentelemetry-operator" title="Permanent link">#</a></h2>
<p>Move to the Base Directory</p>
<p>Command:
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span><span class="nv">$BASE_DIR</span>
</code></pre></div></p>
<p>You should find yourself at the base directory of the repository. If not, then navigate to it.</p>
<p>Create <code>dynatrace</code> namespace</p>
<p>Command:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>dynatrace
</code></pre></div></p>
<p>Sample output:
<div class="highlight"><pre><span></span><code>&gt;<span class="w"> </span>namespace/dynatrace<span class="w"> </span>created
</code></pre></div></p>
<p>Create <code>dynatrace-otelcol-dt-api-credentials</code> secret</p>
<p>The secret holds the API endpoint and API token that OpenTelemetry data will be sent to.</p>
<p>Command:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>create<span class="w"> </span>secret<span class="w"> </span>generic<span class="w"> </span>dynatrace-otelcol-dt-api-credentials<span class="w"> </span>--from-literal<span class="o">=</span><span class="nv">DT_ENDPOINT</span><span class="o">=</span><span class="nv">$DT_ENDPOINT</span><span class="w"> </span>--from-literal<span class="o">=</span><span class="nv">DT_API_TOKEN</span><span class="o">=</span><span class="nv">$DT_API_TOKEN</span><span class="w"> </span>-n<span class="w"> </span>dynatrace
</code></pre></div></p>
<p>Sample output:</p>
<div class="highlight"><pre><span></span><code>&gt;<span class="w"> </span>secret/dynatrace-otelcol-dt-api-credentials<span class="w"> </span>created
</code></pre></div>
<p>Deploy <code>cert-manager</code>, pre-requisite for <code>opentelemetry-operator</code></p>
<p><a href="https://cert-manager.io/docs/installation/" target="_blank">Cert Manager Installation Documentation</a></p>
<p>Command:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>cluster-manifests/cert-manager.yaml
</code></pre></div>
Sample output:</p>
<blockquote>
<p>namespace/cert-manager created\
customresourcedefinition.apiextensions.k8s.io/certificaterequests.cert-manager.io created\
customresourcedefinition.apiextensions.k8s.io/certificates.cert-manager.io created\
...\
validatingwebhookconfiguration.admissionregistration.k8s.io/cert-manager-webhook created</p>
</blockquote>
<p>Wait 30-60 seconds for cert-manager to finish initializing before continuing.</p>
<p>Validate that the Cert Manager components are running.</p>
<p>Command:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>cert-manager
</code></pre></div></p>
<table>
<thead>
<tr>
<th>NAME</th>
<th>READY</th>
<th>STATUS</th>
<th>RESTARTS</th>
<th>AGE</th>
</tr>
</thead>
<tbody>
<tr>
<td>cert-manager-5f7b5dbfbc-fkpzv</td>
<td>1/1</td>
<td>Running</td>
<td>0</td>
<td>1m</td>
</tr>
<tr>
<td>cert-manager-cainjector-7d5b44bb96-kqz7f</td>
<td>1/1</td>
<td>Running</td>
<td>0</td>
<td>1m</td>
</tr>
<tr>
<td>cert-manager-webhook-69459b8974-tsmbq</td>
<td>1/1</td>
<td>Running</td>
<td>0</td>
<td>1m</td>
</tr>
</tbody>
</table>
<p>Deploy <code>opentelemetry-operator</code></p>
<p>The OpenTelemetry Operator will deploy and manage the custom resource <code>OpenTelemetryCollector</code> deployed on the cluster.</p>
<p>Command:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>cluster-manifests/opentelemetry-operator.yaml
</code></pre></div></p>
<p>Sample output:</p>
<blockquote>
<p>namespace/opentelemetry-operator-system created\
customresourcedefinition.apiextensions.k8s.io/instrumentations.opentelemetry.io created\
customresourcedefinition.apiextensions.k8s.io/opampbridges.opentelemetry.io created\
...\
validatingwebhookconfiguration.admissionregistration.k8s.io/opentelemetry-operator-validating-webhook-configuration configured</p>
</blockquote>
<p>Wait 30-60 seconds for opentelemetry-operator-controller-manager to finish initializing before continuing.</p>
<p>Validate that the OpenTelemetry Operator components are running.</p>
<p>Command:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>opentelemetry-operator-system
</code></pre></div></p>
<table>
<thead>
<tr>
<th>NAME</th>
<th>READY</th>
<th>STATUS</th>
<th>RESTARTS</th>
<th>AGE</th>
</tr>
</thead>
<tbody>
<tr>
<td>opentelemetry-operator-controller-manager-5d746dbd64-rf9st</td>
<td>2/2</td>
<td>Running</td>
<td>0</td>
<td>1m</td>
</tr>
</tbody>
</table>
<h2 id="opentelemetry-collector-for-logs">OpenTelemetry Collector for Logs<a class="headerlink" href="#opentelemetry-collector-for-logs" title="Permanent link">#</a></h2>
<p><a href="https://docs.dynatrace.com/docs/extend-dynatrace/opentelemetry/collector/deployment" target="_blank">OpenTelemetry Collector from Dynatrace Documentation</a></p>
<p>Dynatrace offers a sample configuration for the <code>Ingest Pod Logs</code> use case:</p>
<p><a href="https://docs.dynatrace.com/docs/shortlink/otel-collector-cases-k8s-podlogs" target="_blank">Ingest Pod Logs Documentation</a></p>
<p>Move into the lab module directory</p>
<p>Command:
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span><span class="nv">$BASE_DIR</span>/lab-modules/opentelemetry-logs
</code></pre></div></p>
<p><strong>Dynatrace Distro - Daemonset (Node Agent)</strong></p>
<p><a href="https://docs.dynatrace.com/docs/extend-dynatrace/opentelemetry/collector/deployment#tabgroup--dynatrace-docs--agent" target="_blank">OpenTelemetry Collector Node Agent Documentation</a></p>
<p>Pod (and container) logs are written to the filesystem of the Node where the pod is running.  Therefore the Collector must be deployed as a Daemonset to read the log files on the local Node.</p>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">opentelemetry.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OpenTelemetryCollector</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dynatrace-logs</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dynatrace</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">envFrom</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">secretRef</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dynatrace-otelcol-dt-api-credentials</span>
<span class="w">  </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;daemonset&quot;</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ghcr.io/dynatrace/dynatrace-otel-collector/dynatrace-otel-collector:latest&quot;</span>
</code></pre></div>
<p>Command:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>opentelemetry/collector/logs/otel-collector-logs-crd-01.yaml
</code></pre></div></p>
<p>Sample output:</p>
<blockquote>
<p>opentelemetrycollector.opentelemetry.io/dynatrace-logs created</p>
</blockquote>
<p>Validate running pod(s)</p>
<p>Command:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>dynatrace
</code></pre></div></p>
<table>
<thead>
<tr>
<th>NAME</th>
<th>READY</th>
<th>STATUS</th>
<th>RESTARTS</th>
<th>AGE</th>
</tr>
</thead>
<tbody>
<tr>
<td>dynatrace-logs-collector-8q8tz</td>
<td>1/1</td>
<td>Running</td>
<td>0</td>
<td>1m</td>
</tr>
</tbody>
</table>
<h3 id="filelog-receiver"><code>filelog</code> Receiver<a class="headerlink" href="#filelog-receiver" title="Permanent link">#</a></h3>
<p><a href="https://opentelemetry.io/docs/kubernetes/collector/components/#filelog-receiver" target="_blank">Filelog Receiver Documentation</a></p>
<p>The Filelog Receiver tails and parses logs from files. Although it’s not a Kubernetes-specific receiver, it is still the de facto solution for collecting any logs from Kubernetes.  Logs from the Kubernetes Node's filesystem will be read from the Collector running on that Node.  This is why the Collector is deployed as a Daemonset and not a Deployment (or Sidecar).</p>
<p>The Filelog Receiver is composed of Operators that are chained together to process a log. Each Operator performs a simple responsibility, such as parsing a timestamp or JSON. Configuring a Filelog Receiver is not trivial.  Refer to the documentation for details.</p>
<div class="highlight"><pre><span></span><code><span class="nt">config</span><span class="p">:</span>
<span class="w">    </span><span class="nt">receivers</span><span class="p">:</span>
<span class="w">      </span><span class="nt">filelog</span><span class="p">:</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">...</span>
<span class="w">    </span><span class="nt">service</span><span class="p">:</span>
<span class="w">      </span><span class="nt">pipelines</span><span class="p">:</span>
<span class="w">        </span><span class="nt">logs</span><span class="p">:</span>
<span class="w">          </span><span class="nt">receivers</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">filelog</span><span class="p p-Indicator">]</span>
<span class="w">          </span><span class="nt">processors</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">batch</span><span class="p p-Indicator">]</span>
<span class="w">          </span><span class="nt">exporters</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">otlphttp/dynatrace</span><span class="p p-Indicator">]</span>
</code></pre></div>
<p>Query logs in Dynatrace</p>
<p>DQL:
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="n">log</span><span class="p">.</span><span class="n">file</span><span class="p">.</span><span class="n">path</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">100</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">loglevel</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">pod</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="n">log</span><span class="p">.</span><span class="n">file</span><span class="p">.</span><span class="n">path</span>
</code></pre></div>
Result:</p>
<p><img alt="dql_filelog_receiver" src="../img/logs-dql_filelog_receiver.png" /></p>
<h3 id="k8sattributes-processor"><code>k8sattributes</code> Processor<a class="headerlink" href="#k8sattributes-processor" title="Permanent link">#</a></h3>
<p>Add Kubernetes Attributes with the <code>k8sattributes</code> Processor</p>
<p><a href="https://opentelemetry.io/docs/kubernetes/collector/components/#kubernetes-attributes-processor" target="_blank">k8sattributes Processor Documentation</a></p>
<p>The Kubernetes Attributes Processor automatically discovers Kubernetes pods, extracts their metadata, and adds the extracted metadata to spans, metrics, and logs as resource attributes.</p>
<p>The Kubernetes Attributes Processor is one of the most important components for a collector running in Kubernetes. Any collector receiving application data should use it. Because it adds Kubernetes context to your telemetry, the Kubernetes Attributes Processor lets you correlate your application’s traces, metrics, and logs signals with your Kubernetes telemetry, such as pod metrics and traces.</p>
<p>Create <code>clusterrole</code> with read access to Kubernetes objects</p>
<p>Since the processor uses the Kubernetes API, it needs the correct permission to work correctly. For most use cases, you should give the service account running the collector the following permissions via a ClusterRole.</p>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">otel-collector-k8s-clusterrole-logs</span>
<span class="nt">rules</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;pods&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;namespaces&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;nodes&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;watch&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;list&quot;</span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;apps&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;replicasets&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;list&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;watch&quot;</span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;extensions&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;replicasets&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;list&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;watch&quot;</span><span class="p p-Indicator">]</span>
</code></pre></div>
<p>Command:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>opentelemetry/rbac/otel-collector-k8s-clusterrole-logs.yaml
</code></pre></div></p>
<p>Sample output:</p>
<blockquote>
<p>clusterrole.rbac.authorization.k8s.io/otel-collector-k8s-clusterrole-logs created</p>
</blockquote>
<p>Create <code>clusterrolebinding</code> for OpenTelemetry Collector service account</p>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRoleBinding</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">otel-collector-k8s-clusterrole-logs-crb</span>
<span class="nt">subjects</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dynatrace-logs-collector</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dynatrace</span>
<span class="nt">roleRef</span><span class="p">:</span>
<span class="w">  </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">otel-collector-k8s-clusterrole-logs</span>
<span class="w">  </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
</code></pre></div>
<p>Command:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>opentelemetry/rbac/otel-collector-k8s-clusterrole-logs-crb.yaml
</code></pre></div></p>
<p>Sample output:</p>
<blockquote>
<p>clusterrolebinding.rbac.authorization.k8s.io/otel-collector-k8s-clusterrole-logs-crb created</p>
</blockquote>
<p>Add <code>k8sattributes</code> processor</p>
<div class="highlight"><pre><span></span><code><span class="nt">k8sattributes</span><span class="p">:</span>
<span class="w">    </span><span class="nt">auth_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;serviceAccount&quot;</span>
<span class="w">    </span><span class="nt">passthrough</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">filter</span><span class="p p-Indicator">:</span>
<span class="w">        </span><span class="nt">node_from_env_var</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KUBE_NODE_NAME</span>
<span class="w">    </span><span class="nt">extract</span><span class="p">:</span>
<span class="w">        </span><span class="nt">metadata</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.namespace.name</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.deployment.name</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.daemonset.name</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.job.name</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.cronjob.name</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.replicaset.name</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.statefulset.name</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.pod.name</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.pod.uid</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.node.name</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.container.name</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">container.id</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">container.image.name</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">container.image.tag</span>
<span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">tag_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app.label.component</span>
<span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">key</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app.kubernetes.io/component</span>
<span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">from</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pod</span>
<span class="w">    </span><span class="nt">pod_association</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sources</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">from</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">resource_attribute</span>
<span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.pod.uid</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sources</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">from</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">resource_attribute</span>
<span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.pod.name</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sources</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">from</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">resource_attribute</span>
<span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.pod.ip</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">sources</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">from</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">connection</span>
</code></pre></div>
<p>Command:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>opentelemetry/collector/logs/otel-collector-logs-crd-02.yaml
</code></pre></div></p>
<p>Sample output:</p>
<blockquote>
<p>opentelemetrycollector.opentelemetry.io/dynatrace-logs configured</p>
</blockquote>
<p>Validate running pod(s)</p>
<p>Command:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>dynatrace
</code></pre></div></p>
<table>
<thead>
<tr>
<th>NAME</th>
<th>READY</th>
<th>STATUS</th>
<th>RESTARTS</th>
<th>AGE</th>
</tr>
</thead>
<tbody>
<tr>
<td>dynatrace-logs-collector-dns4x</td>
<td>1/1</td>
<td>Running</td>
<td>0</td>
<td>1m</td>
</tr>
</tbody>
</table>
<p>Query logs in Dynatrace</p>
<p>DQL:
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;astronomy-shop&quot;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">100</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">loglevel</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">pod</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">label</span><span class="p">.</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="n">content</span>
</code></pre></div></p>
<p>Result:</p>
<p><img alt="dql_k8sattributes_processor" src="../img/logs-dql_k8sattributes_processor.png" /></p>
<h3 id="resourcedetection-processor"><code>resourcedetection</code> Processor<a class="headerlink" href="#resourcedetection-processor" title="Permanent link">#</a></h3>
<p>The resource detection processor can be used to detect resource information from the host, in a format that conforms to the OpenTelemetry resource semantic conventions, and append or override the resource value in telemetry data with this information.  Detectors are available for AWS, Azure, GCP, and several other platforms; see the documentation for more details.</p>
<p>This processor is a great plugin for adding attributes such as <code>cloud.account.id</code> and <code>k8s.cluster.name</code> to the telemetry.</p>
<p>Add <code>resourcedetection</code> processor</p>
<p><a href="https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/processor/resourcedetectionprocessor/README.md" target="_blank">Resource Detection Processor Documentation</a></p>
<div class="highlight"><pre><span></span><code><span class="nt">processors</span><span class="p">:</span>
<span class="w">  </span><span class="nt">resourcedetection/gcp</span><span class="p">:</span>
<span class="w">    </span><span class="nt">detectors</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">env</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">gcp</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2s</span>
<span class="w">    </span><span class="nt">override</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</code></pre></div>
<p><strong>note:</strong> for this lab, the Kind cluster does not have cloud metadata to collect.  These values will be spoofed for the purposes of this lab.</p>
<div class="highlight"><pre><span></span><code><span class="nt">resource/kind</span><span class="p">:</span>
<span class="w">  </span><span class="nt">attributes</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cloud.account.id</span>
<span class="w">    </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dt-k8s-o11y-account</span>
<span class="w">    </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">insert</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.cluster.name</span>
<span class="w">    </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dt-k8s-o11y-kind</span>
<span class="w">    </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">insert</span>
</code></pre></div>
<p>Command:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>opentelemetry/collector/logs/otel-collector-logs-crd-03.yaml
</code></pre></div></p>
<p>Sample output:</p>
<blockquote>
<p>opentelemetrycollector.opentelemetry.io/dynatrace-logs configured</p>
</blockquote>
<p>Validate running pod(s)
Command:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>dynatrace
</code></pre></div></p>
<table>
<thead>
<tr>
<th>NAME</th>
<th>READY</th>
<th>STATUS</th>
<th>RESTARTS</th>
<th>AGE</th>
</tr>
</thead>
<tbody>
<tr>
<td>dynatrace-logs-collector-fbtk5</td>
<td>1/1</td>
<td>Running</td>
<td>0</td>
<td>1m</td>
</tr>
</tbody>
</table>
<p>Query logs in Dynatrace</p>
<p>DQL:
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="n">cloud</span><span class="p">.</span><span class="n">account</span><span class="p">.</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="k">cluster</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;astronomy-shop&quot;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">100</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">loglevel</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="n">cloud</span><span class="p">.</span><span class="n">account</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="k">cluster</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">content</span>
</code></pre></div></p>
<p>Result:</p>
<p><img alt="dql_resourcedetection_processor" src="../img/logs-dql_resourcedetection_processor.png" /></p>
<h3 id="resource-processor"><code>resource</code> Processor<a class="headerlink" href="#resource-processor" title="Permanent link">#</a></h3>
<p>Add <code>resource</code> processor (attributes)</p>
<p><a href="https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/processor/resourceprocessor" target="_blank">Resource Processor Documentation</a></p>
<p>The <code>resource</code> processor allows us to directly add, remove, or change resource attributes on the telemetry.  View the documentation for more details.</p>
<p>We will use this processor to make the follow changes to our telemetry:
* <code>k8s.pod.ip</code> values in our log data are either the same or invalid; delete the useless attribute
* <code>telemetry.sdk.name</code> set to <code>opentelemetry</code> will allow us to easily identify logs captured through OpenTelemetry
* <code>dynatrace.otel.collector</code> is a non-standardized attribute that we made up to help us identify which Collector captured this data
* <code>dt.security_context</code> is a Dynatrace specific attribute that we use to manage user permissions to the telemetry
    * This could also be set using OpenPipeline, but this puts control of this attribute's value at the app/infra layer (optionally)</p>
<p><div class="highlight"><pre><span></span><code><span class="nt">processors</span><span class="p">:</span>
<span class="w">    </span><span class="nt">resource</span><span class="p">:</span>
<span class="w">        </span><span class="nt">attributes</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.pod.ip</span>
<span class="w">          </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">delete</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">telemetry.sdk.name</span>
<span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">opentelemetry</span>
<span class="w">          </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">insert</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dynatrace.otel.collector</span>
<span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dynatrace-logs</span>
<span class="w">          </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">insert</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dt.security_context</span>
<span class="w">          </span><span class="nt">from_attribute</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.cluster.name</span>
<span class="w">          </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">insert</span>
</code></pre></div>
Command:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>opentelemetry/collector/logs/otel-collector-logs-crd-04.yaml
</code></pre></div></p>
<p>Sample output:</p>
<blockquote>
<p>opentelemetrycollector.opentelemetry.io/dynatrace-logs configured</p>
</blockquote>
<p>Validate running pod(s)</p>
<p>Command:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>dynatrace
</code></pre></div></p>
<table>
<thead>
<tr>
<th>NAME</th>
<th>READY</th>
<th>STATUS</th>
<th>RESTARTS</th>
<th>AGE</th>
</tr>
</thead>
<tbody>
<tr>
<td>dynatrace-logs-collector-xx6km</td>
<td>1/1</td>
<td>Running</td>
<td>0</td>
<td>1m</td>
</tr>
</tbody>
</table>
<p>Query logs in Dynatrace</p>
<p>DQL:
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="n">dt</span><span class="p">.</span><span class="n">security_context</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="n">cloud</span><span class="p">.</span><span class="n">account</span><span class="p">.</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="k">cluster</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;astronomy-shop&quot;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">100</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">loglevel</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="n">dt</span><span class="p">.</span><span class="n">security_context</span><span class="p">,</span><span class="w"> </span><span class="n">dynatrace</span><span class="p">.</span><span class="n">otel</span><span class="p">.</span><span class="n">collector</span><span class="p">,</span><span class="w"> </span><span class="n">cloud</span><span class="p">.</span><span class="n">account</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="k">cluster</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">content</span>
</code></pre></div></p>
<p>Result:</p>
<p><img alt="dql_resource_processor" src="../img/logs-dql_resource_processor.png" /></p>
<h3 id="export-to-otlp-receiver">Export to OTLP Receiver<a class="headerlink" href="#export-to-otlp-receiver" title="Permanent link">#</a></h3>
<p>The <code>astronomy-shop</code> demo application has the OpenTelemetry agents and SDKs already instrumented.  These agents and SDKs are generating logs (traces and metrics too) that are being exported to a Collector running within the <code>astronomy-shop</code> namespace bundled into the application deployment.  We want these logs to be shipped to Dynatrace as well.</p>
<p><a href="https://github.com/open-telemetry/opentelemetry-collector/tree/main/receiver/otlpreceiver" target="_blank">OTLP Receiver Documentation</a></p>
<p>Adding the <code>otlp</code> receiver allows us to receive telemetry from otel exporters, such as agents and other collectors.</p>
<div class="highlight"><pre><span></span><code><span class="nt">config</span><span class="p">:</span>
<span class="w">    </span><span class="nt">receivers</span><span class="p">:</span>
<span class="w">      </span><span class="nt">otlp</span><span class="p">:</span>
<span class="w">        </span><span class="nt">protocols</span><span class="p">:</span>
<span class="w">          </span><span class="nt">grpc</span><span class="p">:</span>
<span class="w">            </span><span class="nt">endpoint</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.0:4317</span>
<span class="w">          </span><span class="nt">http</span><span class="p">:</span>
<span class="w">            </span><span class="nt">endpoint</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.0:4318</span>
<span class="w">    </span><span class="nt">service</span><span class="p">:</span>
<span class="w">      </span><span class="nt">pipelines</span><span class="p">:</span>
<span class="w">        </span><span class="nt">logs</span><span class="p">:</span>
<span class="w">          </span><span class="nt">receivers</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">otlp</span><span class="p p-Indicator">]</span>
<span class="w">          </span><span class="nt">processors</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">batch</span><span class="p p-Indicator">]</span>
<span class="w">          </span><span class="nt">exporters</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">otlphttp/dynatrace</span><span class="p p-Indicator">]</span>
</code></pre></div>
<p>Command:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>opentelemetry/collector/logs/otel-collector-logs-crd-05.yaml
</code></pre></div></p>
<p>Sample output:</p>
<blockquote>
<p>opentelemetrycollector.opentelemetry.io/dynatrace-logs configured</p>
</blockquote>
<p>Validate running pod(s)</p>
<p>Command:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>dynatrace
</code></pre></div></p>
<table>
<thead>
<tr>
<th>NAME</th>
<th>READY</th>
<th>STATUS</th>
<th>RESTARTS</th>
<th>AGE</th>
</tr>
</thead>
<tbody>
<tr>
<td>dynatrace-logs-collector-gu0rm</td>
<td>1/1</td>
<td>Running</td>
<td>0</td>
<td>1m</td>
</tr>
</tbody>
</table>
<p>Customize astronomy-shop helm values</p>
<p>OpenTelemetry data created by agents and SDKs should include <code>service.name</code> and <code>service.namespace</code> attributes.  We will make the <code>service.namespace</code> unique to our deployment using our <code>NAME</code> environment variable declared earlier, using a <code>sed</code> command on the Helm chart's <code>values.yaml</code> file.</p>
<p><div class="highlight"><pre><span></span><code><span class="nt">default</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># List of environment variables applied to all components</span>
<span class="w">  </span><span class="nt">env</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OTEL_SERVICE_NAME</span>
<span class="w">      </span><span class="nt">valueFrom</span><span class="p">:</span>
<span class="w">        </span><span class="nt">fieldRef</span><span class="p">:</span>
<span class="w">          </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="w">          </span><span class="nt">fieldPath</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;metadata.labels[&#39;app.kubernetes.io/component&#39;]&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OTEL_COLLECTOR_NAME</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;{{</span><span class="nv"> </span><span class="s">include</span><span class="nv"> </span><span class="s">&quot;otel-demo.name&quot;</span><span class="nv"> </span><span class="s">.</span><span class="nv"> </span><span class="s">}}-otelcol&#39;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OTEL_EXPORTER_OTLP_METRICS_TEMPORALITY_PREFERENCE</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cumulative</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OTEL_RESOURCE_ATTRIBUTES</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;service.name=$(OTEL_SERVICE_NAME),service.namespace=NAME_TO_REPLACE,service.version={{</span><span class="nv"> </span><span class="s">.Chart.AppVersion</span><span class="nv"> </span><span class="s">}}&#39;</span>
</code></pre></div>
<code>service.namespace=NAME_TO_REPLACE</code></p>
<blockquote>
<p>service.namespace=INITIALS-k8s-otel-o11y</p>
</blockquote>
<p>Command:
<div class="highlight"><pre><span></span><code>sed<span class="w"> </span>-i<span class="w"> </span><span class="s2">&quot;s,NAME_TO_REPLACE,</span><span class="nv">$NAME</span><span class="s2">,&quot;</span><span class="w"> </span>astronomy-shop/collector-values.yaml
</code></pre></div></p>
<h3 id="update-astronomy-shop-via-helm">Update Astronomy Shop via Helm<a class="headerlink" href="#update-astronomy-shop-via-helm" title="Permanent link">#</a></h3>
<p>Our <code>collector-values.yaml</code> contains new configurations for the application so that the <code>astronomy-shop</code> Collector includes exporters that ship to the Collectors deployed in the <code>dynatrace</code> namespace.</p>
<div class="highlight"><pre><span></span><code><span class="nt">exporters</span><span class="p">:</span>
<span class="w">  </span><span class="c1"># Dynatrace OTel Collectors</span>
<span class="w">  </span><span class="nt">otlphttp/dttraces</span><span class="p">:</span>
<span class="w">    </span><span class="nt">endpoint</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://dynatrace-traces-collector.dynatrace.svc.cluster.local:4318</span>
<span class="w">  </span><span class="nt">otlphttp/dtlogs</span><span class="p">:</span>
<span class="w">    </span><span class="nt">endpoint</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://dynatrace-logs-collector.dynatrace.svc.cluster.local:4318</span>
<span class="w">  </span><span class="nt">otlphttp/dtmetrics</span><span class="p">:</span>
<span class="w">    </span><span class="nt">endpoint</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://dynatrace-metrics-cluster-collector.dynatrace.svc.cluster.local:4318</span>
</code></pre></div>
<p>Command:
<div class="highlight"><pre><span></span><code>helm<span class="w"> </span>upgrade<span class="w"> </span>astronomy-shop<span class="w"> </span>open-telemetry/opentelemetry-demo<span class="w"> </span>--values<span class="w"> </span>astronomy-shop/collector-values.yaml<span class="w"> </span>--namespace<span class="w"> </span>astronomy-shop<span class="w"> </span>--version<span class="w"> </span><span class="s2">&quot;0.31.0&quot;</span>
</code></pre></div></p>
<p>Sample output:</p>
<blockquote>
<p>NAME: astronomy-shop\
LAST DEPLOYED: Thu Jun 27 20:58:38 2024\
NAMESPACE: astronomy-shop\
STATUS: deployed\
REVISION: 2</p>
</blockquote>
<p>Query logs in Dynatrace</p>
<p>DQL:
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;astronomy-shop&quot;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="n">service</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">100</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="k">cluster</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">pod</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="n">namespace</span><span class="p">,</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="k">language</span><span class="p">,</span><span class="w"> </span><span class="n">otel</span><span class="p">.</span><span class="k">scope</span><span class="p">.</span><span class="n">name</span>
</code></pre></div></p>
<p>Result:</p>
<p><img alt="dql_otel_sdk_logs" src="../img/logs-dql_otel_sdk_logs.png" /></p>
<h2 id="opentelemetry-collector-for-events">OpenTelemetry Collector for Events<a class="headerlink" href="#opentelemetry-collector-for-events" title="Permanent link">#</a></h2>
<p>The Kubernetes Objects receiver collects, either by pulling or watching, objects from the Kubernetes API server. The most common use case for this receiver is watching Kubernetes events, but it can be used to collect any type of Kubernetes object.</p>
<h3 id="k8sobjects-receiver"><code>k8sobjects</code> Receiver<a class="headerlink" href="#k8sobjects-receiver" title="Permanent link">#</a></h3>
<p><a href="https://opentelemetry.io/docs/kubernetes/collector/components/#kubernetes-objects-receiver" target="_blank">Kubernetes Objects Receiver Documentation</a></p>
<p>Our goal is to capture any events related to the <code>astronomy-shop</code> and <code>dynatrace</code> namespaces.</p>
<div class="highlight"><pre><span></span><code><span class="nt">receivers</span><span class="p">:</span>
<span class="w">  </span><span class="nt">k8sobjects/events</span><span class="p">:</span>
<span class="w">    </span><span class="nt">auth_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">serviceAccount</span>
<span class="w">    </span><span class="nt">objects</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">events</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">watch</span>
<span class="w">        </span><span class="nt">namespaces</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">astronomy-shop</span><span class="p p-Indicator">,</span><span class="nv">dynatrace</span><span class="p p-Indicator">]</span>
</code></pre></div>
<p>The <code>k8sobjects</code> receiver is only available on the Contrib Distro of the OpenTelemetry Collector.  Therefore we must deploy a new Collector using the <code>contrib</code> image.</p>
<p>Create <code>clusterrole</code> with read access to Kubernetes events</p>
<p>Since the processor uses the Kubernetes API, it needs the correct permission to work correctly. Since service accounts are the only authentication option you must give the service account the proper access. For any object you want to collect you need to ensure the name is added to the cluster role. </p>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">otel-collector-k8s-clusterrole-events</span>
<span class="nt">rules</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">apiGroups</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;events&quot;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">verbs</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;get&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;watch&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;list&quot;</span><span class="p p-Indicator">]</span>
</code></pre></div>
<p>Command:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>opentelemetry/rbac/otel-collector-k8s-clusterrole-events.yaml
</code></pre></div></p>
<p>Sample output:</p>
<blockquote>
<p>clusterrole.rbac.authorization.k8s.io/otel-collector-k8s-clusterrole-events created</p>
</blockquote>
<p>Create <code>clusterrolebinding</code> for OpenTelemetry Collector service account</p>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRoleBinding</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">otel-collector-k8s-clusterrole-events-crb</span>
<span class="nt">subjects</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dynatrace-events-collector</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dynatrace</span>
<span class="nt">roleRef</span><span class="p">:</span>
<span class="w">  </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">otel-collector-k8s-clusterrole-events</span>
<span class="w">  </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
</code></pre></div>
<p>Command:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>opentelemetry/rbac/otel-collector-k8s-clusterrole-events-crb.yaml
</code></pre></div></p>
<p>Sample output:</p>
<blockquote>
<p>clusterrolebinding.rbac.authorization.k8s.io/otel-collector-k8s-clusterrole-events-crb created</p>
</blockquote>
<p>Add <code>k8sobjects</code> receiver to collect Kubernetes events as logs</p>
<div class="highlight"><pre><span></span><code><span class="nt">receivers</span><span class="p">:</span>
<span class="w">  </span><span class="nt">k8sobjects/events</span><span class="p">:</span>
<span class="w">    </span><span class="nt">auth_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">serviceAccount</span>
<span class="w">    </span><span class="nt">objects</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">events</span>
<span class="w">        </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">watch</span>
<span class="w">        </span><span class="nt">namespaces</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">astronomy-shop</span><span class="p p-Indicator">,</span><span class="nv">dynatrace</span><span class="p p-Indicator">]</span>
</code></pre></div>
<h3 id="deploy-opentelemetry-collector-gateway">Deploy OpenTelemetry Collector (Gateway)<a class="headerlink" href="#deploy-opentelemetry-collector-gateway" title="Permanent link">#</a></h3>
<p>Since the receiver gathers telemetry for the cluster as a whole, only one instance of the receiver is needed across the cluster in order to collect all the data.</p>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">opentelemetry.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OpenTelemetryCollector</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dynatrace-events</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dynatrace</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">envFrom</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">secretRef</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dynatrace-otelcol-dt-api-credentials</span>
<span class="w">  </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;deployment&quot;</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;otel/opentelemetry-collector-contrib:latest&quot;</span>
</code></pre></div>
<p>Command:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>opentelemetry/collector/events/otel-collector-events-crd-01.yaml
</code></pre></div></p>
<p>Sample output:</p>
<blockquote>
<p>opentelemetrycollector.opentelemetry.io/dynatrace-events created</p>
</blockquote>
<p>Validate running pod(s)</p>
<p>Command:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>dynatrace
</code></pre></div></p>
<table>
<thead>
<tr>
<th>NAME</th>
<th>READY</th>
<th>STATUS</th>
<th>RESTARTS</th>
<th>AGE</th>
</tr>
</thead>
<tbody>
<tr>
<td>dynatrace-events-collector-559d5b9d77-rb26d</td>
<td>1/1</td>
<td>Running</td>
<td>0</td>
<td>1m</td>
</tr>
</tbody>
</table>
<h3 id="generate-events">Generate Events<a class="headerlink" href="#generate-events" title="Permanent link">#</a></h3>
<p><a href="https://kubernetes.io/docs/reference/kubectl/generated/kubectl_scale/" target="_blank">Kubectl Scale Command Documentation</a></p>
<p>We can generate new Kubernetes events related to the <code>astronomy-shop</code> namespace by scaling a deployment up and then scaling it back down.</p>
<p>Command:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>scale<span class="w"> </span>deployment<span class="w"> </span>astronomy-shop-imageprovider<span class="w"> </span>-n<span class="w"> </span>astronomy-shop<span class="w"> </span>--replicas<span class="o">=</span><span class="m">2</span>
</code></pre></div></p>
<p>Sample output:</p>
<blockquote>
<p>deployment.apps/astronomy-shop-imageprovider scaled</p>
</blockquote>
<p>Command:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>astronomy-shop<span class="w"> </span>-l<span class="w"> </span>app.kubernetes.io/name<span class="o">=</span>astronomy-shop-imageprovider
</code></pre></div></p>
<table>
<thead>
<tr>
<th>NAME</th>
<th>READY</th>
<th>STATUS</th>
<th>RESTARTS</th>
<th>AGE</th>
</tr>
</thead>
<tbody>
<tr>
<td>astronomy-shop-imageprovider-84b549cf4c-nwm7z</td>
<td>2/2</td>
<td>Running</td>
<td>0</td>
<td>9m</td>
</tr>
<tr>
<td>astronomy-shop-imageprovider-84b549cf4c-rs7rz</td>
<td>2/2</td>
<td>Running</td>
<td>0</td>
<td>1m</td>
</tr>
</tbody>
</table>
<p>Command:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>scale<span class="w"> </span>deployment<span class="w"> </span>astronomy-shop-imageprovider<span class="w"> </span>-n<span class="w"> </span>astronomy-shop<span class="w"> </span>--replicas<span class="o">=</span><span class="m">1</span>
</code></pre></div></p>
<p>Sample output:</p>
<blockquote>
<p>deployment.apps/astronomy-shop-imageprovider scaled</p>
</blockquote>
<p>Command:
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>astronomy-shop<span class="w"> </span>-l<span class="w"> </span>app.kubernetes.io/name<span class="o">=</span>astronomy-shop-imageprovider
</code></pre></div></p>
<table>
<thead>
<tr>
<th>NAME</th>
<th>READY</th>
<th>STATUS</th>
<th>RESTARTS</th>
<th>AGE</th>
</tr>
</thead>
<tbody>
<tr>
<td>astronomy-shop-imageprovider-84b549cf4c-nwm7z</td>
<td>2/2</td>
<td>Running</td>
<td>0</td>
<td>9m</td>
</tr>
</tbody>
</table>
<p>Query logs in Dynatrace</p>
<p>DQL:
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">dynatrace</span><span class="p">.</span><span class="n">otel</span><span class="p">.</span><span class="n">collector</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;dynatrace-events&quot;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="k">domain</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;k8s&quot;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">resource</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;events&quot;</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="n">namespace</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;astronomy-shop&quot;</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">100</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="k">cluster</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="err">{</span><span class="k">object</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="n">namespace</span><span class="p">,</span><span class="w"> </span><span class="k">alias</span><span class="p">:</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">reason</span><span class="p">,</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="n">name</span>
</code></pre></div></p>
<p>Result:</p>
<p><img alt="dql_k8s_events" src="../img/logs-dql_k8s_events.png" /></p>
<h2 id="wrap-up">Wrap Up<a class="headerlink" href="#wrap-up" title="Permanent link">#</a></h2>
<p><strong>What You Learned Today</strong></p>
<p>By completing this module, you've successfully deployed the OpenTelemetry Collector to collect logs, enrich log attributes for better context, and ship those logs to Dynatrace for analysis.</p>
<ul>
<li>The OpenTelemetry Collector was deployed as a DaemonSet, behaving as an Agent running on each Node</li>
<li>The Dynatrace Distro of OpenTelemetry Collector includes supported modules needed to ship logs to Dynatrace<ul>
<li>The <code>filelog</code> receiver scrapes logs from the Node filesystem and parses the contents</li>
<li>The <code>otlp</code> receiver receives logs that are exported from agents, SDKs, and other Collectors</li>
<li>The <code>k8sattributes</code> processor enriches the logs with Kubernetes attributes</li>
<li>The <code>resourcedetection</code> processor enriches the logs with cloud and cluster attributes</li>
<li>The <code>resource</code> processor enriches the logs with custom (resource) attributes</li>
</ul>
</li>
<li>The Community Contrib Distro of OpenTelemetry Collector includes modules needed to ship events to Dynatrace<ul>
<li>The <code>k8sobjects</code> receiver watches for Kubernetes events (and other resources) on the cluster</li>
</ul>
</li>
<li>Dynatrace DQL (via Notebooks) allows you to perform powerful queries and analysis of the log data</li>
</ul>
<h2 id="continue">Continue<a class="headerlink" href="#continue" title="Permanent link">#</a></h2>
<p>Next we'll deploy the OpenTelemetry Capstone to capture logs, metrics, and traces with OpenTelemetry Collectors.</p>
<div class="grid cards">
<ul>
<li><a href="../5-opentelemetry-capstone/">Continue to OpenTelemetry Capstone<span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span></a></li>
</ul>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy"], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>