
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../5-opentelemetry-capstone/">
      
      
        <link rel="next" href="../7-dynatrace-openpipeline-astronomy-shop-logs/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.42">
    
    
      
        <title>6. Dynatrace OpenPipeline Collector Logs - Dynatrace Enablement Lab: OpenTelemetry Logs and OpenPipeline</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
  <!-- Add scripts that need to run before here -->
  
      
    
  <!-- Add scripts that need to run afterwards here -->
   Create an agentless RUM application before GoLive
   <!-- TODO: BeforeGoLive: Replace Agentless RUM Snippet
    1. Create an agentless application in Dynatrace from with convention 'dynatrace-wwse/repositoryname'
    2. https://hci34192.apps.dynatrace.com/ui/apps/dynatrace.classic.deploy.agentless/#install/agentless;gtf=-2h;gf=all
    <script type="text/javascript" src="https://js-cdn.dynatrace.com/jstag/PLACEHOLDEr/REPLACE_WITH_YOUR_SNIPPET/1234abcd1234abcd_complete.js" crossorigin="anonymous"></script>
    -->
    <script type="text/javascript" src="https://js-cdn.dynatrace.com/jstag/145e12d594f/bf64904yne/6c910e7a6d2a6ab4_complete.js" crossorigin="anonymous"></script>

    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#dynatrace-openpipeline-collector-logs" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Dynatrace Enablement Lab: OpenTelemetry Logs and OpenPipeline" class="md-header__button md-logo" aria-label="Dynatrace Enablement Lab: OpenTelemetry Logs and OpenPipeline" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Dynatrace Enablement Lab: OpenTelemetry Logs and OpenPipeline
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              6. Dynatrace OpenPipeline Collector Logs
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/dynatrace-wwse/enablement-kubernetes-opentelemetry-openpipeline" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    View Code on GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Dynatrace Enablement Lab: OpenTelemetry Logs and OpenPipeline" class="md-nav__button md-logo" aria-label="Dynatrace Enablement Lab: OpenTelemetry Logs and OpenPipeline" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Dynatrace Enablement Lab: OpenTelemetry Logs and OpenPipeline
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/dynatrace-wwse/enablement-kubernetes-opentelemetry-openpipeline" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    View Code on GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. About
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../2-getting-started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Getting started
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../3-codespaces/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Codespaces
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../4-opentelemetry-logs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. OpenTelemetry Logs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../5-opentelemetry-capstone/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. OpenTelemetry Capstone
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    6. Dynatrace OpenPipeline Collector Logs
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    6. Dynatrace OpenPipeline Collector Logs
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#query-logs" class="md-nav__link">
    <span class="md-ellipsis">
      Query Logs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Query Logs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parse-json-content" class="md-nav__link">
    <span class="md-ellipsis">
      Parse JSON Content
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-loglevel-and-status-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Set loglevel and status fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-unwanted-fieldsattributes" class="md-nav__link">
    <span class="md-ellipsis">
      Remove unwanted fields/attributes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extract-successful-data-points-metric" class="md-nav__link">
    <span class="md-ellipsis">
      Extract Successful Data Points Metric
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extract-dropped-data-points-metric" class="md-nav__link">
    <span class="md-ellipsis">
      Extract Dropped Data Points Metric
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alert-on-zero-data-points" class="md-nav__link">
    <span class="md-ellipsis">
      Alert on Zero Data Points
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-openpipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Configure OpenPipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configure OpenPipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parse-json-content_1" class="md-nav__link">
    <span class="md-ellipsis">
      Parse JSON Content
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loglevel-and-status" class="md-nav__link">
    <span class="md-ellipsis">
      Loglevel and Status
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Remove Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-spaces-from-metrics-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Remove Spaces from Metrics Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-spaces-from-logs-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Remove Spaces from Logs Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-spaces-from-traces-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Remove Spaces from Traces Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#collector-attribute" class="md-nav__link">
    <span class="md-ellipsis">
      Collector Attribute
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zero-data-points-for-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Zero Data Points for Metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zero-data-points-for-logs" class="md-nav__link">
    <span class="md-ellipsis">
      Zero Data Points for Logs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zero-data-points-for-traces" class="md-nav__link">
    <span class="md-ellipsis">
      Zero Data Points for Traces
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#successful-data-points-for-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Successful Data Points for Metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#successful-data-points-for-logs" class="md-nav__link">
    <span class="md-ellipsis">
      Successful Data Points for Logs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#successful-data-points-for-traces" class="md-nav__link">
    <span class="md-ellipsis">
      Successful Data Points for Traces
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dropped-data-points" class="md-nav__link">
    <span class="md-ellipsis">
      Dropped Data Points
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-route" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamic Route
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyze-results" class="md-nav__link">
    <span class="md-ellipsis">
      Analyze Results
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Analyze Results">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#analyze-the-results-in-dynatrace-notebook" class="md-nav__link">
    <span class="md-ellipsis">
      Analyze the results in Dynatrace (Notebook)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opentelemetry-collector-dashboard" class="md-nav__link">
    <span class="md-ellipsis">
      OpenTelemetry Collector Dashboard
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wrap-up" class="md-nav__link">
    <span class="md-ellipsis">
      Wrap Up
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#continue" class="md-nav__link">
    <span class="md-ellipsis">
      Continue
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../7-dynatrace-openpipeline-astronomy-shop-logs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7. Dynatrace OpenPipeline Astronomy Shop Logs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../8-dynatrace-openpipeline-kubernetes-events/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8. Dynatrace OpenPipeline Kubernetes Events
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cleanup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9. Cleanup
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#query-logs" class="md-nav__link">
    <span class="md-ellipsis">
      Query Logs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Query Logs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parse-json-content" class="md-nav__link">
    <span class="md-ellipsis">
      Parse JSON Content
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-loglevel-and-status-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Set loglevel and status fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-unwanted-fieldsattributes" class="md-nav__link">
    <span class="md-ellipsis">
      Remove unwanted fields/attributes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extract-successful-data-points-metric" class="md-nav__link">
    <span class="md-ellipsis">
      Extract Successful Data Points Metric
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extract-dropped-data-points-metric" class="md-nav__link">
    <span class="md-ellipsis">
      Extract Dropped Data Points Metric
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alert-on-zero-data-points" class="md-nav__link">
    <span class="md-ellipsis">
      Alert on Zero Data Points
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-openpipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Configure OpenPipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configure OpenPipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parse-json-content_1" class="md-nav__link">
    <span class="md-ellipsis">
      Parse JSON Content
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loglevel-and-status" class="md-nav__link">
    <span class="md-ellipsis">
      Loglevel and Status
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Remove Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-spaces-from-metrics-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Remove Spaces from Metrics Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-spaces-from-logs-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Remove Spaces from Logs Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-spaces-from-traces-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Remove Spaces from Traces Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#collector-attribute" class="md-nav__link">
    <span class="md-ellipsis">
      Collector Attribute
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zero-data-points-for-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Zero Data Points for Metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zero-data-points-for-logs" class="md-nav__link">
    <span class="md-ellipsis">
      Zero Data Points for Logs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zero-data-points-for-traces" class="md-nav__link">
    <span class="md-ellipsis">
      Zero Data Points for Traces
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#successful-data-points-for-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Successful Data Points for Metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#successful-data-points-for-logs" class="md-nav__link">
    <span class="md-ellipsis">
      Successful Data Points for Logs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#successful-data-points-for-traces" class="md-nav__link">
    <span class="md-ellipsis">
      Successful Data Points for Traces
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dropped-data-points" class="md-nav__link">
    <span class="md-ellipsis">
      Dropped Data Points
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-route" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamic Route
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyze-results" class="md-nav__link">
    <span class="md-ellipsis">
      Analyze Results
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Analyze Results">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#analyze-the-results-in-dynatrace-notebook" class="md-nav__link">
    <span class="md-ellipsis">
      Analyze the results in Dynatrace (Notebook)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opentelemetry-collector-dashboard" class="md-nav__link">
    <span class="md-ellipsis">
      OpenTelemetry Collector Dashboard
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wrap-up" class="md-nav__link">
    <span class="md-ellipsis">
      Wrap Up
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#continue" class="md-nav__link">
    <span class="md-ellipsis">
      Continue
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="dynatrace-openpipeline-collector-logs">Dynatrace OpenPipeline - Collector Logs<a class="headerlink" href="#dynatrace-openpipeline-collector-logs" title="Permanent link">#</a></h1>
<script>
document.addEventListener('DOMContentLoaded', function() {
  dynatrace.sendBizEvent('page_load', {"page": "6. Dynatrace OpenPipeline Collector Logs"})
});
</script>

<p>In this module we'll utilize Dynatrace OpenPipeline to process OpenTelemetry Collector logs at ingest, in order to make them easier to analyze and leverage.  The logs will be ingested by OpenTelemetry Collector, deployed on Kubernetes as part of the previous module.  The OpenTelemetry Collector logs are output mixed JSON/console format, making them difficult to use by default.  With OpenPipeline, the logs will be processed at ingest, to manipulate fields, extract metrics, and raise alert events in case of any issues.</p>
<p><strong>Goals:</strong></p>
<ul>
<li>Parse JSON content</li>
<li>Set loglevel and status</li>
<li>Remove unwanted fields/attributes</li>
<li>Extract metrics: successful data points</li>
<li>Extract metrics: dropped data points</li>
<li>Alert: zero data points</li>
</ul>
<p><img alt="OpenPipeline" src="../img/dt_opp_mrkt_header.png" /></p>
<p>OpenPipeline is an architectural component of Dynatrace SaaS.  It resides between the Dynatrace SaaS tenant and <a href="https://docs.dynatrace.com/docs/discover-dynatrace/platform/grail/dynatrace-grail">Grail</a> data lakehouse.  Logs (,traces, metrics, events, and more) are sent to the Dynatrace SaaS tenant and route through OpenPipeline where they are enriched, transformed, and contextualized prior to being stored in Grail.</p>
<div class="grid cards">
<ul>
<li><a href="https://docs.dynatrace.com/docs/discover-dynatrace/platform/openpipeline/concepts/data-flow" target="_blank">Learn More<span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span></a></li>
</ul>
</div>
<h2 id="query-logs">Query Logs<a class="headerlink" href="#query-logs" title="Permanent link">#</a></h2>
<p>Query and discover the OpenTelemetry Collector logs as they are ingested and stored in Dynatrace.  Use Dynatrace Query Language (DQL) to transform the logs at query time and prepare for Dynatrace OpenPipeline configuration.</p>
<p><strong>Import Notebook into Dynatrace</strong></p>
<p><a href="https://github.com/dynatrace-wwse/enablement-kubernetes-opentelemetry-openpipeline/blob/main/assets/dynatrace/notebooks/opentelemetry-collector-logs.json" target="_blank">Download OpenTelemetry Collector Logs Notebook</a></p>
<p><strong>OpenTelemetry Collector Logs - Ondemand Processing at Query Time (Notebook)</strong></p>
<p>The OpenTelemetry Collector can be configured to output JSON structured logs as internal telemetry.  Dynatrace DQL can be used to filter, process, and analyze this log data to ensure reliability of the OpenTelemetry data pipeline.</p>
<p>Query logs in Dynatrace</p>
<p>DQL:
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;dynatrace&quot;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;otc-container&quot;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;opentelemetry&quot;</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">50</span>
</code></pre></div></p>
<p>Result:</p>
<p><img alt="Query Collector Logs" src="../img/dt_opp-otel_collector_query_logs_dql.png" /></p>
<h3 id="parse-json-content">Parse JSON Content<a class="headerlink" href="#parse-json-content" title="Permanent link">#</a></h3>
<p><a href="https://docs.dynatrace.com/docs/platform/grail/dynatrace-query-language/commands/extraction-and-parsing-commands#parse" target="_blank">Parse Command Documentation</a></p>
<p>Parses a record field and puts the result(s) into one or more fields as specified in the pattern.  The parse command works in combination with the Dynatrace Pattern Language for parsing strings.</p>
<p><a href="https://docs.dynatrace.com/docs/platform/grail/dynatrace-pattern-language/log-processing-json-object" target="_blank">Parse JSON Object Documentation</a></p>
<p>There are several ways how to control parsing elements from a JSON object. The easiest is to use the JSON matcher without any parameters. It will enumerate all elements, transform them into Log processing data type from their defined type in JSON and returns a variant_object with parsed elements.</p>
<p>The <code>content</code> field contains JSON structured details that can be parsed to better analyze relevant fields. The structured content can then be flattened for easier analysis.</p>
<p><a href="https://docs.dynatrace.com/docs/platform/grail/dynatrace-query-language/commands/structuring-commands#fieldsFlatten" target="_blank">FieldsFlatten Command Documentation</a></p>
<p>Sample:
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;info&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;ts&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-12-31T19:36:45.773Z&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;msg&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Logs&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;otelcol.component.id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;debug&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;otelcol.component.kind&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Exporter&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;otelcol.signal&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;logs&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;resource logs&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;131&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;log records&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;800&quot;</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Query logs in Dynatrace</p>
<p>DQL:
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;dynatrace&quot;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;otc-container&quot;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;opentelemetry&quot;</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">50</span>
<span class="o">|</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;JSON:jc&quot;</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsFlatten</span><span class="w"> </span><span class="n">jc</span><span class="p">,</span><span class="w"> </span><span class="k">prefix</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;content.&quot;</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsKeep</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">label</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="n">jc</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;content.*&quot;</span>
</code></pre></div></p>
<p>Result:</p>
<p><img alt="Parse Content" src="../img/dt_opp-otel_collector_parse_content_dql.png" /></p>
<h3 id="set-loglevel-and-status-fields">Set <code>loglevel</code> and <code>status</code> fields<a class="headerlink" href="#set-loglevel-and-status-fields" title="Permanent link">#</a></h3>
<p><a href="https://docs.dynatrace.com/docs/platform/grail/dynatrace-query-language/commands/selection-and-modification-commands" target="_blank">Selection and Modification Documentation</a></p>
<p>The <code>fieldsAdd</code> command evaluates an expression and appends or replaces a field.</p>
<p>The JSON structure contains a field <code>level</code> that can be used to set the <code>loglevel</code> field.  It must be uppercase.</p>
<ul>
<li>loglevel possible values are: NONE, TRACE, DEBUG, NOTICE, INFO, WARN, SEVERE, ERROR, CRITICAL, ALERT, FATAL, EMERGENCY</li>
<li>status field possible values are: ERROR, WARN, INFO, NONE</li>
</ul>
<p>The <code>if</code> conditional function allows you to set a value based on a conditional expression.  Since the <code>status</code> field depends on the <code>loglevel</code> field, a nested <code>if</code> expression can be used.</p>
<p><a href="https://docs.dynatrace.com/docs/platform/grail/dynatrace-query-language/functions/conditional-functions#if" target="_blank">If Function Documentation</a></p>
<p>Query logs in Dynatrace</p>
<p>DQL:
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;dynatrace&quot;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;otc-container&quot;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;opentelemetry&quot;</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">50</span>
<span class="o">|</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;JSON:jc&quot;</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsFlatten</span><span class="w"> </span><span class="n">jc</span><span class="p">,</span><span class="w"> </span><span class="k">prefix</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;content.&quot;</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsAdd</span><span class="w"> </span><span class="n">loglevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">upper</span><span class="p">(</span><span class="n">content</span><span class="p">.</span><span class="k">level</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsAdd</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">loglevel</span><span class="o">==</span><span class="ss">&quot;INFO&quot;</span><span class="p">,</span><span class="ss">&quot;INFO&quot;</span><span class="p">,</span><span class="k">else</span><span class="p">:</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">most</span><span class="w"> </span><span class="n">likely</span><span class="w"> </span><span class="k">first</span>
<span class="w">                     </span><span class="k">if</span><span class="p">(</span><span class="n">loglevel</span><span class="o">==</span><span class="ss">&quot;WARN&quot;</span><span class="p">,</span><span class="ss">&quot;WARN&quot;</span><span class="p">,</span><span class="k">else</span><span class="p">:</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="k">second</span><span class="w"> </span><span class="n">most</span><span class="w"> </span><span class="n">likely</span><span class="w"> </span><span class="k">second</span>
<span class="w">                     </span><span class="k">if</span><span class="p">(</span><span class="n">loglevel</span><span class="o">==</span><span class="ss">&quot;ERROR&quot;</span><span class="p">,</span><span class="ss">&quot;ERROR&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">else</span><span class="p">:</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">third</span><span class="w"> </span><span class="n">most</span><span class="w"> </span><span class="n">likely</span><span class="w"> </span><span class="n">third</span>
<span class="w">                     </span><span class="k">if</span><span class="p">(</span><span class="n">loglevel</span><span class="o">==</span><span class="ss">&quot;NONE&quot;</span><span class="p">,</span><span class="ss">&quot;NONE&quot;</span><span class="p">,</span><span class="k">else</span><span class="p">:</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">fourth</span><span class="w"> </span><span class="n">most</span><span class="w"> </span><span class="n">likely</span><span class="w"> </span><span class="n">fourth</span>
<span class="w">                     </span><span class="k">if</span><span class="p">(</span><span class="n">loglevel</span><span class="o">==</span><span class="ss">&quot;TRACE&quot;</span><span class="p">,</span><span class="ss">&quot;INFO&quot;</span><span class="p">,</span><span class="k">else</span><span class="p">:</span>
<span class="w">                     </span><span class="k">if</span><span class="p">(</span><span class="n">loglevel</span><span class="o">==</span><span class="ss">&quot;DEBUG&quot;</span><span class="p">,</span><span class="ss">&quot;INFO&quot;</span><span class="p">,</span><span class="k">else</span><span class="p">:</span>
<span class="w">                     </span><span class="k">if</span><span class="p">(</span><span class="n">loglevel</span><span class="o">==</span><span class="ss">&quot;NOTICE&quot;</span><span class="p">,</span><span class="ss">&quot;INFO&quot;</span><span class="p">,</span><span class="k">else</span><span class="p">:</span>
<span class="w">                     </span><span class="k">if</span><span class="p">(</span><span class="n">loglevel</span><span class="o">==</span><span class="ss">&quot;SEVERE&quot;</span><span class="p">,</span><span class="ss">&quot;ERROR&quot;</span><span class="p">,</span><span class="k">else</span><span class="p">:</span>
<span class="w">                     </span><span class="k">if</span><span class="p">(</span><span class="n">loglevel</span><span class="o">==</span><span class="ss">&quot;CRITICAL&quot;</span><span class="p">,</span><span class="ss">&quot;ERROR&quot;</span><span class="p">,</span><span class="k">else</span><span class="p">:</span>
<span class="w">                     </span><span class="k">if</span><span class="p">(</span><span class="n">loglevel</span><span class="o">==</span><span class="ss">&quot;ALERT&quot;</span><span class="p">,</span><span class="ss">&quot;ERROR&quot;</span><span class="p">,</span><span class="k">else</span><span class="p">:</span>
<span class="w">                     </span><span class="k">if</span><span class="p">(</span><span class="n">loglevel</span><span class="o">==</span><span class="ss">&quot;FATAL&quot;</span><span class="p">,</span><span class="ss">&quot;ERROR&quot;</span><span class="p">,</span><span class="k">else</span><span class="p">:</span>
<span class="w">                     </span><span class="k">if</span><span class="p">(</span><span class="n">loglevel</span><span class="o">==</span><span class="ss">&quot;EMERGENCY&quot;</span><span class="p">,</span><span class="ss">&quot;ERROR&quot;</span><span class="p">,</span><span class="k">else</span><span class="p">:</span>
<span class="w">                     </span><span class="ss">&quot;NONE&quot;</span><span class="p">))))))))))))</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">loglevel</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="p">.</span><span class="k">level</span>
</code></pre></div></p>
<p>Result:</p>
<p><img alt="Loglevel and Status" src="../img/dt_opp-otel_collector_loglevel_dql.png" /></p>
<h3 id="remove-unwanted-fieldsattributes">Remove unwanted fields/attributes<a class="headerlink" href="#remove-unwanted-fieldsattributes" title="Permanent link">#</a></h3>
<p>The <code>fieldsRemove</code> command will remove selected fields.</p>
<p><a href="https://docs.dynatrace.com/docs/platform/grail/dynatrace-query-language/commands/selection-and-modification-commands#fieldsRemove" target="_blank">FieldsRemove Command Documentation</a></p>
<p>After parsing and flattening the JSON structured content, the original fields should be removed.  Fields that don't add value should be removed at the source, but if they are not, they can be removed with DQL.</p>
<p>Every log record should ideally have a content field, as it is expected.  The <code>content</code> field can be updated with values from other fields, such as <code>content.msg</code> and <code>content.message</code>.</p>
<p>Query logs in Dynatrace</p>
<p>DQL:
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;dynatrace&quot;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;otc-container&quot;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;opentelemetry&quot;</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">50</span>
<span class="o">|</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;JSON:jc&quot;</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsFlatten</span><span class="w"> </span><span class="n">jc</span><span class="p">,</span><span class="w"> </span><span class="k">prefix</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;content.&quot;</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsRemove</span><span class="w"> </span><span class="n">jc</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="p">.</span><span class="k">level</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="p">.</span><span class="n">ts</span><span class="p">,</span><span class="w"> </span><span class="n">log</span><span class="p">.</span><span class="n">iostream</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsAdd</span><span class="w"> </span><span class="n">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="p">((</span><span class="n">isNotNull</span><span class="p">(</span><span class="n">content</span><span class="p">.</span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="n">content</span><span class="p">.</span><span class="n">message</span><span class="p">)),</span><span class="w"> </span><span class="n">concat</span><span class="p">(</span><span class="n">content</span><span class="p">.</span><span class="n">msg</span><span class="p">,</span><span class="ss">&quot; | &quot;</span><span class="p">,</span><span class="n">content</span><span class="p">.</span><span class="n">message</span><span class="p">),</span><span class="w"> </span><span class="k">else</span><span class="p">:</span>
<span class="w">                      </span><span class="k">if</span><span class="p">((</span><span class="n">isNotNull</span><span class="p">(</span><span class="n">content</span><span class="p">.</span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">isNull</span><span class="p">(</span><span class="n">content</span><span class="p">.</span><span class="n">message</span><span class="p">)),</span><span class="w"> </span><span class="n">content</span><span class="p">.</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="k">else</span><span class="p">:</span>
<span class="w">                      </span><span class="k">if</span><span class="p">((</span><span class="k">isNull</span><span class="p">(</span><span class="n">content</span><span class="p">.</span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="n">content</span><span class="p">.</span><span class="n">message</span><span class="p">)),</span><span class="w"> </span><span class="n">content</span><span class="p">.</span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="k">else</span><span class="p">:</span>
<span class="w">                      </span><span class="n">content</span><span class="p">)))</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="p">.</span><span class="n">msg</span>
</code></pre></div></p>
<p>Result:</p>
<p><img alt="Remove Fields" src="../img/dt_opp-otel_collector_fieldsremove_dql.png" /></p>
<h3 id="extract-successful-data-points-metric">Extract Successful Data Points Metric<a class="headerlink" href="#extract-successful-data-points-metric" title="Permanent link">#</a></h3>
<p>The <code>summarize</code> command enables you to aggregate records to compute results based on counts, attribute values, and more.</p>
<p><a href="https://docs.dynatrace.com/docs/platform/grail/dynatrace-query-language/commands/aggregation-commands#summarize" target="_blank">Summarize Command Documentation</a></p>
<p>The JSON structured content contains several fields that indicate the number of successful data points / signals sent by the exporter.</p>
<ul>
<li>logs: resource logs, log records</li>
<li>metrics: resource metrics, metrics, data points</li>
<li>traces: resource spans, spans</li>
</ul>
<p>Query logs in Dynatrace</p>
<p>DQL:
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;dynatrace&quot;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;otc-container&quot;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;opentelemetry&quot;</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;JSON:jc&quot;</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsFlatten</span><span class="w"> </span><span class="n">jc</span><span class="p">,</span><span class="w"> </span><span class="k">prefix</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;content.&quot;</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="o">`</span><span class="n">content</span><span class="p">.</span><span class="n">otelcol</span><span class="p">.</span><span class="n">component</span><span class="p">.</span><span class="n">kind</span><span class="o">`</span><span class="p">,</span><span class="ss">&quot;Exporter&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsRemove</span><span class="w"> </span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="n">jc</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="p">.</span><span class="k">level</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="p">.</span><span class="n">ts</span><span class="p">,</span><span class="w"> </span><span class="n">log</span><span class="p">.</span><span class="n">iostream</span>
<span class="o">|</span><span class="w"> </span><span class="n">summarize</span><span class="w"> </span><span class="err">{</span>
<span class="w">              </span><span class="n">resource_metrics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="o">`</span><span class="n">content</span><span class="p">.</span><span class="n">resource</span><span class="w"> </span><span class="n">metrics</span><span class="o">`</span><span class="p">),</span>
<span class="w">              </span><span class="n">metrics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="o">`</span><span class="n">content</span><span class="p">.</span><span class="n">metrics</span><span class="o">`</span><span class="p">),</span>
<span class="w">              </span><span class="n">data_points</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="o">`</span><span class="n">content</span><span class="p">.</span><span class="k">data</span><span class="w"> </span><span class="n">points</span><span class="o">`</span><span class="p">),</span>
<span class="w">              </span><span class="n">resource_spans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="o">`</span><span class="n">content</span><span class="p">.</span><span class="n">resource</span><span class="w"> </span><span class="n">spans</span><span class="o">`</span><span class="p">),</span>
<span class="w">              </span><span class="n">spans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="o">`</span><span class="n">content</span><span class="p">.</span><span class="n">spans</span><span class="o">`</span><span class="p">),</span>
<span class="w">              </span><span class="n">resource_logs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="o">`</span><span class="n">content</span><span class="p">.</span><span class="n">resource</span><span class="w"> </span><span class="n">logs</span><span class="o">`</span><span class="p">),</span>
<span class="w">              </span><span class="n">log_records</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="o">`</span><span class="n">content</span><span class="p">.</span><span class="n">log</span><span class="w"> </span><span class="n">records</span><span class="o">`</span><span class="p">)</span>
<span class="w">              </span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="k">by</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="n">signal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">`</span><span class="n">content</span><span class="p">.</span><span class="n">otelcol</span><span class="p">.</span><span class="n">signal</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="n">exporter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">`</span><span class="n">content</span><span class="p">.</span><span class="n">otelcol</span><span class="p">.</span><span class="n">component</span><span class="p">.</span><span class="n">id</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="n">collector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">label</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="k">cluster</span><span class="p">.</span><span class="n">name</span><span class="err">}</span>
</code></pre></div></p>
<p>Result:</p>
<p><img alt="Success Metrics" src="../img/dt_opp-otel_collector_success_metrics_dql.png" /></p>
<h3 id="extract-dropped-data-points-metric">Extract Dropped Data Points Metric<a class="headerlink" href="#extract-dropped-data-points-metric" title="Permanent link">#</a></h3>
<p>The JSON structured content contains several fields that indicate the number of dropped data points / signals sent by the exporter.</p>
<ul>
<li>dropped items</li>
<li>signal</li>
<li>(exporter) name</li>
<li>collector</li>
</ul>
<p>Query logs in Dynatrace</p>
<p>DQL:
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;dynatrace&quot;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;otc-container&quot;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;opentelemetry&quot;</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;JSON:jc&quot;</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsFlatten</span><span class="w"> </span><span class="n">jc</span><span class="p">,</span><span class="w"> </span><span class="k">prefix</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;content.&quot;</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="o">`</span><span class="n">content</span><span class="p">.</span><span class="n">otelcol</span><span class="p">.</span><span class="n">component</span><span class="p">.</span><span class="n">kind</span><span class="o">`</span><span class="p">,</span><span class="ss">&quot;exporter&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="o">`</span><span class="n">content</span><span class="p">.</span><span class="k">level</span><span class="o">`</span><span class="p">,</span><span class="ss">&quot;error&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="o">`</span><span class="n">content</span><span class="p">.</span><span class="n">dropped_items</span><span class="o">`</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">summarize</span><span class="w"> </span><span class="n">dropped_items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="o">`</span><span class="n">content</span><span class="p">.</span><span class="n">dropped_items</span><span class="o">`</span><span class="p">),</span><span class="w"> </span><span class="k">by</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">signal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">`</span><span class="n">content</span><span class="p">.</span><span class="n">otelcol</span><span class="p">.</span><span class="n">signal</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="n">collector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">label</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">`</span><span class="n">content</span><span class="p">.</span><span class="n">otelcol</span><span class="p">.</span><span class="n">component</span><span class="p">.</span><span class="n">id</span><span class="o">`</span><span class="err">}</span>
</code></pre></div></p>
<p>Result:</p>
<p><img alt="Drop Metrics" src="../img/dt_opp-otel_collector_drops_metrics_dql.png" /></p>
<p>You likely won't have any data matching your query as you shouldn't have data drops.  You can force data drops by toggling your Dynatrace API Access Token off for a couple minutes and then turning it back on.</p>
<p><img alt="Toggle Token" src="../img/dt_opp-otel_collector_toggle_token.png" /></p>
<h3 id="alert-on-zero-data-points">Alert on Zero Data Points<a class="headerlink" href="#alert-on-zero-data-points" title="Permanent link">#</a></h3>
<p>It would be unexpected that the collector exporter doesn't send any data points or signals.  We could alert on this unexpected behavior.</p>
<p>The field <code>content.otelcol.signal</code> will indicate the type of data point or signal.  The fields <code>content.log records</code>, <code>content.data points</code>, and <code>content.spans</code> will indicate the number of signals sent.  If the value is <code>0</code>, that is unexpected.</p>
<p>Query logs in Dynatrace</p>
<p>DQL:
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;dynatrace&quot;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;otc-container&quot;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;opentelemetry&quot;</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">100</span>
<span class="o">|</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;JSON:jc&quot;</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsFlatten</span><span class="w"> </span><span class="n">jc</span><span class="p">,</span><span class="w"> </span><span class="k">prefix</span><span class="p">:</span><span class="w"> </span><span class="ss">&quot;content.&quot;</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="o">`</span><span class="n">content</span><span class="p">.</span><span class="n">otelcol</span><span class="p">.</span><span class="n">component</span><span class="p">.</span><span class="n">kind</span><span class="o">`</span><span class="p">,</span><span class="ss">&quot;exporter&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">summarize</span><span class="w"> </span><span class="err">{</span>
<span class="w">              </span><span class="n">logs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">countIf</span><span class="p">(</span><span class="n">matchesValue</span><span class="p">(</span><span class="o">`</span><span class="n">content</span><span class="p">.</span><span class="n">otelcol</span><span class="p">.</span><span class="n">signal</span><span class="o">`</span><span class="p">,</span><span class="ss">&quot;logs&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">toString</span><span class="p">(</span><span class="o">`</span><span class="n">content</span><span class="p">.</span><span class="n">log</span><span class="w"> </span><span class="n">records</span><span class="o">`</span><span class="p">),</span><span class="ss">&quot;0&quot;</span><span class="p">)),</span>
<span class="w">              </span><span class="n">metrics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">countIf</span><span class="p">(</span><span class="n">matchesValue</span><span class="p">(</span><span class="o">`</span><span class="n">content</span><span class="p">.</span><span class="n">otelcol</span><span class="p">.</span><span class="n">signal</span><span class="o">`</span><span class="p">,</span><span class="ss">&quot;metrics&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">toString</span><span class="p">(</span><span class="o">`</span><span class="n">content</span><span class="p">.</span><span class="k">data</span><span class="w"> </span><span class="n">points</span><span class="o">`</span><span class="p">),</span><span class="ss">&quot;0&quot;</span><span class="p">)),</span>
<span class="w">              </span><span class="n">traces</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">countIf</span><span class="p">(</span><span class="n">matchesValue</span><span class="p">(</span><span class="o">`</span><span class="n">content</span><span class="p">.</span><span class="n">otelcol</span><span class="p">.</span><span class="n">signal</span><span class="o">`</span><span class="p">,</span><span class="ss">&quot;traces&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">toString</span><span class="p">(</span><span class="o">`</span><span class="n">content</span><span class="p">.</span><span class="n">spans</span><span class="o">`</span><span class="p">),</span><span class="ss">&quot;0&quot;</span><span class="p">))</span>
<span class="w">            </span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="k">by</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">signal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">`</span><span class="n">content</span><span class="p">.</span><span class="n">otelcol</span><span class="p">.</span><span class="n">signal</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="n">collector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">label</span><span class="p">.</span><span class="n">name</span><span class="err">}</span>
</code></pre></div></p>
<p>Result:</p>
<p><img alt="Zero Data" src="../img/dt_opp-otel_collector_zero_data_metrics_dql.png" /></p>
<p><strong>DQL in Notebooks Summary</strong></p>
<p>DQL gives you the power to filter, parse, summarize, and analyze log data quickly and on the fly.  This is great for use cases where the format of your log data is unexpected.  However, when you know the format of your log data and you know how you will want to use that log data in the future, you'll want that data to be parsed and presented a certain way during ingest.  OpenPipeline provides the capabilites needed to accomplish this.</p>
<h2 id="configure-openpipeline">Configure OpenPipeline<a class="headerlink" href="#configure-openpipeline" title="Permanent link">#</a></h2>
<p>Configure Dynatrace OpenPipeline for OpenTelemetry Collector logs.</p>
<div class="admonition tip">
<p class="admonition-title">View Images</p>
<p>If the images are too small and the text is difficult to read, right-click and open the image in a new tab.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Save Often</p>
<p>Consider saving your pipeline configuration often to avoid losing any changes.</p>
</div>
<p>In your Dynatrace tenant, launch the OpenPipeline app.  Begin by selecting <code>Logs</code> from the left-hand menu of telemetry types.  Then choose <code>Pipelines</code>.  Click on <code>+ Pipeline</code> to add a new pipeline.</p>
<p><img alt="Add Pipeline" src="../img/dt_opp-otel_collector_opp_add_pipeline.png" /></p>
<p>Name the new pipeline, <code>OpenTelemetry Collector Logs</code>.  Click on the <code>Processing</code> tab to begin adding <code>Processor</code> rules.</p>
<p><img alt="Name Pipeline" src="../img/dt_opp-otel_collector_opp_name_pipeline.png" /></p>
<h3 id="parse-json-content_1">Parse JSON Content<a class="headerlink" href="#parse-json-content_1" title="Permanent link">#</a></h3>
<p>Add a processor to parse the JSON structured content field.  Click on <code>+ Processor</code> to add a new processor.</p>
<p>Name:
<div class="highlight"><pre><span></span><code>Parse JSON Content
</code></pre></div></p>
<p>Matching condition:
<div class="highlight"><pre><span></span><code>k8s.namespace.name == &quot;dynatrace&quot; and k8s.container.name == &quot;otc-container&quot; and telemetry.sdk.name == &quot;opentelemetry&quot;
</code></pre></div></p>
<p>Processor definition:
<div class="highlight"><pre><span></span><code>parse content, &quot;JSON:jc&quot;
| fieldsFlatten jc, prefix: &quot;content.&quot;
</code></pre></div></p>
<p><img alt="Parse JSON Content" src="../img/dt_opp-otel_collector_opp_parse_json_content.png" /></p>
<h3 id="loglevel-and-status">Loglevel and Status<a class="headerlink" href="#loglevel-and-status" title="Permanent link">#</a></h3>
<p>Add a processor to set the loglevel and status fields.  Click on <code>+ Processor</code> to add a new processor.</p>
<p>Name:
<div class="highlight"><pre><span></span><code>Set loglevel and status fields
</code></pre></div></p>
<p>Matching condition:
<div class="highlight"><pre><span></span><code>isNotNull(`content.level`)
</code></pre></div></p>
<p>Processor definition:
<div class="highlight"><pre><span></span><code>fieldsAdd loglevel = upper(content.level)
| fieldsAdd status = if(loglevel==&quot;INFO&quot;,&quot;INFO&quot;,else: // most likely first
                     if(loglevel==&quot;WARN&quot;,&quot;WARN&quot;,else: // second most likely second
                     if(loglevel==&quot;ERROR&quot;,&quot;ERROR&quot;, else: // third most likely third
                     if(loglevel==&quot;NONE&quot;,&quot;NONE&quot;,else: // fourth most likely fourth
                     if(loglevel==&quot;TRACE&quot;,&quot;INFO&quot;,else:
                     if(loglevel==&quot;DEBUG&quot;,&quot;INFO&quot;,else:
                     if(loglevel==&quot;NOTICE&quot;,&quot;INFO&quot;,else:
                     if(loglevel==&quot;SEVERE&quot;,&quot;ERROR&quot;,else:
                     if(loglevel==&quot;CRITICAL&quot;,&quot;ERROR&quot;,else:
                     if(loglevel==&quot;ALERT&quot;,&quot;ERROR&quot;,else:
                     if(loglevel==&quot;FATAL&quot;,&quot;ERROR&quot;,else:
                     if(loglevel==&quot;EMERGENCY&quot;,&quot;ERROR&quot;,else:
                     &quot;NONE&quot;))))))))))))
</code></pre></div></p>
<p><img alt="Loglevel and Status" src="../img/dt_opp-otel_collector_opp_loglevel_status.png" /></p>
<h3 id="remove-fields">Remove Fields<a class="headerlink" href="#remove-fields" title="Permanent link">#</a></h3>
<p>Add a processor to remove the extra and unwanted fields.  Click on <code>+ Processor</code> to add a new processor.</p>
<p>Name:
<div class="highlight"><pre><span></span><code>Remove unwanted fields/attributes
</code></pre></div></p>
<p>Matching condition:
<div class="highlight"><pre><span></span><code>isNotNull(jc) and isNotNull(loglevel) and isNotNull(status) and loglevel!=&quot;NONE&quot;
</code></pre></div></p>
<p>DQL processor definition
<div class="highlight"><pre><span></span><code>fieldsRemove jc, content.level, content.ts, log.iostream
| fieldsAdd content = if((isNotNull(content.msg) and isNotNull(content.message)), concat(content.msg,&quot; | &quot;,content.message), else:
                      if((isNotNull(content.msg) and isNull(content.message)), content.msg, else:
                      if((isNull(content.msg) and isNotNull(content.message)), content.message, else:
                      content)))
</code></pre></div></p>
<p><img alt="Remove Unwanted Fields" src="../img/dt_opp-otel_collector_opp_remove_fields.png" /></p>
<h3 id="remove-spaces-from-metrics-fields">Remove Spaces from Metrics Fields<a class="headerlink" href="#remove-spaces-from-metrics-fields" title="Permanent link">#</a></h3>
<p>Add a processor to remove the spaces from the metrics fields.  Click on <code>+ Processor</code> to add a new processor.</p>
<p>Name:
<div class="highlight"><pre><span></span><code>Metric extraction - remove spaces from fields - metrics
</code></pre></div></p>
<p>Matching condition:
<div class="highlight"><pre><span></span><code>matchesValue(`content.otelcol.component.kind`,&quot;exporter&quot;) and matchesValue(`content.otelcol.signal`,&quot;metrics&quot;)
</code></pre></div></p>
<p>DQL processor definition
<div class="highlight"><pre><span></span><code>fieldsAdd content.resource_metrics = `content.resource metrics`
| fieldsAdd content.data_points = `content.data points`
| fieldsRemove `content.resource metrics`, `content.data points`
</code></pre></div></p>
<p><img alt="Remove Spaces from Fields - Metrics" src="../img/dt_opp-otel_collector_opp_metric_fields_metrics.png" /></p>
<h3 id="remove-spaces-from-logs-fields">Remove Spaces from Logs Fields<a class="headerlink" href="#remove-spaces-from-logs-fields" title="Permanent link">#</a></h3>
<p>Add a processor to remove the spaces from the logs fields.  Click on <code>+ Processor</code> to add a new processor.</p>
<p>Name:
<div class="highlight"><pre><span></span><code>Metric extraction - remove spaces from fields - logs
</code></pre></div></p>
<p>Matching condition:
<div class="highlight"><pre><span></span><code>matchesValue(`content.otelcol.component.kind`,&quot;exporter&quot;) and matchesValue(`content.otelcol.signal`,&quot;logs&quot;)
</code></pre></div></p>
<p>DQL processor definition
<div class="highlight"><pre><span></span><code>fieldsAdd content.resource_logs = `content.resource logs`
| fieldsAdd content.log_records = `content.log records`
| fieldsRemove `content.resource logs`, `content.log records`
</code></pre></div></p>
<p><img alt="Remove Spaces from Fields - Logs" src="../img/dt_opp-otel_collector_opp_metric_fields_logs.png" /></p>
<h3 id="remove-spaces-from-traces-fields">Remove Spaces from Traces Fields<a class="headerlink" href="#remove-spaces-from-traces-fields" title="Permanent link">#</a></h3>
<p>Add a processor to remove the spaces from the traces fields.  Click on <code>+ Processor</code> to add a new processor.</p>
<p>Name:
<div class="highlight"><pre><span></span><code>Metric extraction - remove spaces from fields - traces
</code></pre></div></p>
<p>Matching condition:
<div class="highlight"><pre><span></span><code>matchesValue(`content.otelcol.component.kind`,&quot;exporter&quot;) and matchesValue(`content.otelcol.signal`,&quot;traces&quot;)
</code></pre></div></p>
<p>DQL processor definition
<div class="highlight"><pre><span></span><code>fieldsAdd content.resource_spans = `content.resource spans`
| fieldsRemove `content.resource spans`
</code></pre></div></p>
<p><img alt="Remove Spaces from Fields - Traces" src="../img/dt_opp-otel_collector_opp_metric_fields_traces.png" /></p>
<h3 id="collector-attribute">Collector Attribute<a class="headerlink" href="#collector-attribute" title="Permanent link">#</a></h3>
<p>Add a processor to add the collector attribute from the app.label.name field.  Click on <code>+ Processor</code> to add a new processor.</p>
<p>Name:
<div class="highlight"><pre><span></span><code>Add collector attribute from app.label.name
</code></pre></div></p>
<p>Matching condition:
<div class="highlight"><pre><span></span><code>isNotNull(app.label.name)
</code></pre></div></p>
<p>DQL processor definition
<div class="highlight"><pre><span></span><code>fieldsAdd collector = app.label.name
</code></pre></div></p>
<p><img alt="Collector Attribute" src="../img/dt_opp-otel_collector_opp_add_collector_attribute.png" /></p>
<div class="admonition tip">
<p class="admonition-title">Consider Saving</p>
<p>Consider saving your pipeline configuration often to avoid losing any changes.</p>
</div>
<h3 id="zero-data-points-for-metrics">Zero Data Points for Metrics<a class="headerlink" href="#zero-data-points-for-metrics" title="Permanent link">#</a></h3>
<p>Switch to the <code>Data extraction</code> tab.</p>
<p>Add a processor to extract a <code>Davis Event</code>.  Click on <code>+ Processor</code> to add a new processor.</p>
<p>Name:
<div class="highlight"><pre><span></span><code>Zero data points / signals - metrics
</code></pre></div></p>
<p>Matching condition:
<div class="highlight"><pre><span></span><code>matchesValue(`content.otelcol.signal`,&quot;metrics&quot;) and `content.data_points` == 0
</code></pre></div></p>
<p>Event Name:
<div class="highlight"><pre><span></span><code>OpenTelemetry Collector - Zero Data Points - Metrics
</code></pre></div></p>
<p>Event description:
<div class="highlight"><pre><span></span><code>The OpenTelemetry Collector has sent zero data points for metrics.
</code></pre></div></p>
<p>Additional event properties:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>collector</td>
<td>{collector}</td>
</tr>
<tr>
<td>k8s.cluster.name</td>
<td>{k8s.cluster.name}</td>
</tr>
<tr>
<td>k8s.pod.name</td>
<td>{k8s.pod.name}</td>
</tr>
</tbody>
</table>
<p><img alt="Zero Signals - Metrics" src="../img/dt_opp-otel_collector_opp_davis_event_zero_metrics.png" /></p>
<h3 id="zero-data-points-for-logs">Zero Data Points for Logs<a class="headerlink" href="#zero-data-points-for-logs" title="Permanent link">#</a></h3>
<p>Add a processor to extract a <code>Davis Event</code>.  Click on <code>+ Processor</code> to add a new processor.</p>
<p>Name:
<div class="highlight"><pre><span></span><code>Zero data points / signals - logs
</code></pre></div></p>
<p>Matching condition:
<div class="highlight"><pre><span></span><code>matchesValue(`content.otelcol.signal`,&quot;logs&quot;) and `content.log_records` == 0
</code></pre></div></p>
<p>Event Name:
<div class="highlight"><pre><span></span><code>OpenTelemetry Collector - Zero Data Points - Logs
</code></pre></div></p>
<p>Event description:
<div class="highlight"><pre><span></span><code>The OpenTelemetry Collector has sent zero data points for logs.
</code></pre></div></p>
<p>Additional event properties:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>collector</td>
<td>{collector}</td>
</tr>
<tr>
<td>k8s.cluster.name</td>
<td>{k8s.cluster.name}</td>
</tr>
<tr>
<td>k8s.pod.name</td>
<td>{k8s.pod.name}</td>
</tr>
</tbody>
</table>
<p><img alt="Zero Signals - Logs" src="../img/dt_opp-otel_collector_opp_davis_event_zero_logs.png" /></p>
<h3 id="zero-data-points-for-traces">Zero Data Points for Traces<a class="headerlink" href="#zero-data-points-for-traces" title="Permanent link">#</a></h3>
<p>Add a processor to extract a <code>Davis Event</code>.  Click on <code>+ Processor</code> to add a new processor.</p>
<p>Name:
<div class="highlight"><pre><span></span><code>Zero data points / signals - traces
</code></pre></div></p>
<p>Matching condition:
<div class="highlight"><pre><span></span><code>matchesValue(`content.otelcol.signal`,&quot;traces&quot;) and `content.spans` == 0
</code></pre></div></p>
<p>Event Name:
<div class="highlight"><pre><span></span><code>OpenTelemetry Collector - Zero Data Points - Traces
</code></pre></div></p>
<p>Event description:
<div class="highlight"><pre><span></span><code>The OpenTelemetry Collector has sent zero data points for traces.
</code></pre></div></p>
<p>Additional event properties:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>collector</td>
<td>{collector}</td>
</tr>
<tr>
<td>k8s.cluster.name</td>
<td>{k8s.cluster.name}</td>
</tr>
<tr>
<td>k8s.pod.name</td>
<td>{k8s.pod.name}</td>
</tr>
</tbody>
</table>
<p><img alt="Zero Signals - Traces" src="../img/dt_opp-otel_collector_opp_davis_event_zero_traces.png" /></p>
<div class="admonition tip">
<p class="admonition-title">Consider Saving</p>
<p>Consider saving your pipeline configuration often to avoid losing any changes.</p>
</div>
<h3 id="successful-data-points-for-metrics">Successful Data Points for Metrics<a class="headerlink" href="#successful-data-points-for-metrics" title="Permanent link">#</a></h3>
<p>Switch to the <code>Metric Extraction</code> tab.</p>
<p>Add a processor to extract a metric for successful metric data points from the exporter logs.  Click on <code>+ Processor</code> to add a new processor.</p>
<p>Name:
<div class="highlight"><pre><span></span><code>Successful data points - metrics
</code></pre></div></p>
<p>Matching condition:
<div class="highlight"><pre><span></span><code>matchesValue(`content.otelcol.component.kind`,&quot;exporter&quot;) and matchesValue(`content.otelcol.signal`,&quot;metrics&quot;)
</code></pre></div></p>
<p>Field Extraction:
<div class="highlight"><pre><span></span><code>content.data_points
</code></pre></div></p>
<p>Metric Key:
<div class="highlight"><pre><span></span><code>otelcol_exporter_sent_metric_data_points
</code></pre></div></p>
<p>Dimensions:</p>
<table>
<thead>
<tr>
<th>Dimension</th>
</tr>
</thead>
<tbody>
<tr>
<td>collector</td>
</tr>
<tr>
<td>k8s.cluster.name</td>
</tr>
<tr>
<td>k8s.pod.name</td>
</tr>
</tbody>
</table>
<p><img alt="Successful Data Points - Metrics" src="../img/dt_opp-otel_collector_opp_metric_successful_metrics.png" /></p>
<h3 id="successful-data-points-for-logs">Successful Data Points for Logs<a class="headerlink" href="#successful-data-points-for-logs" title="Permanent link">#</a></h3>
<p>Add a processor to extract a metric for successful log data points from the exporter logs.  Click on <code>+ Processor</code> to add a new processor.</p>
<p>Name:
<div class="highlight"><pre><span></span><code>Successful data points - logs
</code></pre></div></p>
<p>Matching condition:
<div class="highlight"><pre><span></span><code>matchesValue(`content.otelcol.component.kind`,&quot;exporter&quot;) and matchesValue(`content.otelcol.signal`,&quot;logs&quot;)
</code></pre></div></p>
<p>Field Extraction:
<div class="highlight"><pre><span></span><code>content.log_records
</code></pre></div></p>
<p>Metric Key:
<div class="highlight"><pre><span></span><code>otelcol_exporter_sent_log_records
</code></pre></div></p>
<p>Dimensions:</p>
<table>
<thead>
<tr>
<th>Dimension</th>
</tr>
</thead>
<tbody>
<tr>
<td>collector</td>
</tr>
<tr>
<td>k8s.cluster.name</td>
</tr>
<tr>
<td>k8s.pod.name</td>
</tr>
</tbody>
</table>
<p><img alt="Successful Data Points - Logs" src="../img/dt_opp-otel_collector_opp_metric_successful_logs.png" /></p>
<h3 id="successful-data-points-for-traces">Successful Data Points for Traces<a class="headerlink" href="#successful-data-points-for-traces" title="Permanent link">#</a></h3>
<p>Add a processor to extract a metric for successful trace data points from the exporter logs.  Click on <code>+ Processor</code> to add a new processor.</p>
<p>Name:
<div class="highlight"><pre><span></span><code>Successful data points - traces
</code></pre></div></p>
<p>Matching condition:
<div class="highlight"><pre><span></span><code>matchesValue(`content.otelcol.component.kind`,&quot;exporter&quot;) and matchesValue(`content.otelcol.signal`,&quot;traces&quot;)
</code></pre></div></p>
<p>Field Extraction:
<div class="highlight"><pre><span></span><code>content.spans
</code></pre></div></p>
<p>Metric Key:
<div class="highlight"><pre><span></span><code>otelcol_exporter_sent_trace_spans
</code></pre></div></p>
<p>Dimensions:</p>
<table>
<thead>
<tr>
<th>Dimension</th>
</tr>
</thead>
<tbody>
<tr>
<td>collector</td>
</tr>
<tr>
<td>k8s.cluster.name</td>
</tr>
<tr>
<td>k8s.pod.name</td>
</tr>
</tbody>
</table>
<p><img alt="Successful Data Points - Traces" src="../img/dt_opp-otel_collector_opp_metric_successful_traces.png" /></p>
<h3 id="dropped-data-points">Dropped Data Points<a class="headerlink" href="#dropped-data-points" title="Permanent link">#</a></h3>
<p>Add a processor to extract a metric for dropped data points from the exporter logs.  Click on <code>+ Processor</code> to add a new processor.</p>
<p>Name:
<div class="highlight"><pre><span></span><code>Dropped data points
</code></pre></div></p>
<p>Matching condition:
<div class="highlight"><pre><span></span><code>matchesValue(`content.otelcol.component.kind`,&quot;exporter&quot;) and isNotNull(`content.dropped_items`) and isNotNull(`content.otelcol.signal`)
</code></pre></div></p>
<p>Field Extraction:
<div class="highlight"><pre><span></span><code>content.dropped_data_points
</code></pre></div></p>
<p>Metric Key:
<div class="highlight"><pre><span></span><code>otelcol_exporter_dropped_data_points_by_data_type
</code></pre></div></p>
<p>Dimensions:</p>
<table>
<thead>
<tr>
<th>Dimension</th>
</tr>
</thead>
<tbody>
<tr>
<td>collector</td>
</tr>
<tr>
<td>k8s.cluster.name</td>
</tr>
<tr>
<td>k8s.pod.name</td>
</tr>
</tbody>
</table>
<p><img alt="Dropped Data Points" src="../img/dt_opp-otel_collector_opp_metric_dropped_data_points.png" /></p>
<p>The pipeline is now configured, click on <code>Save</code> to save the pipeline configuration.</p>
<p><img alt="Save Pipeline" src="../img/dt_opp-otel_collector_opp_save_pipeline.png" /></p>
<h3 id="dynamic-route">Dynamic Route<a class="headerlink" href="#dynamic-route" title="Permanent link">#</a></h3>
<p>A pipeline will not have any effect unless logs are configured to be routed to the pipeline.  With dynamic routing, data is routed based on a matching condition. The matching condition is a DQL query that defines the data set you want to route.</p>
<p>Click on <code>Dynamic Routing</code> to configure a route to the target pipeline.  Click on <code>+ Dynamic Route</code> to add a new route.</p>
<p><img alt="Add Route" src="../img/dt_opp-otel_collector_opp_add_route.png" /></p>
<p>Configure the <code>Dynamic Route</code> to use the <code>OpenTelemetry Collector Logs</code> pipeline.</p>
<p>Name:
<div class="highlight"><pre><span></span><code>OpenTelemetry Collector Logs
</code></pre></div></p>
<p>Matching condition:
<div class="highlight"><pre><span></span><code>matchesValue(k8s.namespace.name,&quot;dynatrace&quot;) and matchesValue(k8s.container.name,&quot;otc-container&quot;) and matchesValue(telemetry.sdk.name,&quot;opentelemetry&quot;)
</code></pre></div></p>
<p>Pipeline:
<div class="highlight"><pre><span></span><code>OpenTelemetry Collector Logs
</code></pre></div></p>
<p>Click <code>Add</code> to add the route.</p>
<p><img alt="Configure Route" src="../img/dt_opp-otel_collector_opp_configure_route.png" /></p>
<p>Validate that the route is enabled in the <code>Status</code> column.  Click on <code>Save</code> to save the dynamic route table configuration.</p>
<p><img alt="Save Routes" src="../img/dt_opp-otel_collector_opp_save_routes.png" /></p>
<p>Allow <code>dynatrace</code> OpenTelemetry Collectors to generate new log data that will be routed through the new pipeline (3-5 minutes).</p>
<h2 id="analyze-results">Analyze Results<a class="headerlink" href="#analyze-results" title="Permanent link">#</a></h2>
<p>Analyze the OpenTelemetry Collector logs after Dynatrace OpenPipeline processing.  Run the queries from the Notebook.</p>
<h3 id="analyze-the-results-in-dynatrace-notebook">Analyze the results in Dynatrace (Notebook)<a class="headerlink" href="#analyze-the-results-in-dynatrace-notebook" title="Permanent link">#</a></h3>
<p>Query the OpenTelemetry Collector logs that have been processed by Dynatrace OpenPipeline.</p>
<p>DQL: OpenPipeline Processing Results
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;dynatrace&quot;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;otc-container&quot;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;opentelemetry&quot;</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsRemove</span><span class="w"> </span><span class="n">cloud</span><span class="p">.</span><span class="n">account</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">removed</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="n">privacy</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">security</span><span class="w"> </span><span class="n">reasons</span><span class="w"> </span><span class="k">only</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">50</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsKeep</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">collector</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="k">cluster</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">loglevel</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;content.*&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">content</span>
</code></pre></div></p>
<p>Result:</p>
<p><img alt="OpenPipeline Processing Results" src="../img/dt_opp-otel_collector_analyze_query_logs_post.png" /></p>
<p>The logs are now parsed at ingest into a format that simplifies our queries and makes them easier to use, especially for users that don't work with these log sources or Dynatrace DQL on a regular basis.</p>
<p>Query the new log metric extracted by Dynatrace OpenPipeline, using the <code>timeseries</code> command.</p>
<p>DQL: Extracted metrics: successful data points / signals
<div class="highlight"><pre><span></span><code><span class="n">timeseries</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="n">logs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">log</span><span class="p">.</span><span class="n">otelcol_exporter_sent_log_records</span><span class="p">)</span><span class="w"> </span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="k">by</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">k8s</span><span class="p">.</span><span class="k">cluster</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">collector</span><span class="err">}</span>
</code></pre></div></p>
<p>Result:</p>
<p><img alt="Success Metric" src="../img/dt_opp-otel_collector_analyze_query_logs_metric.png" /></p>
<p>By extracting the metric(s) at ingest time, the data points are stored long term and can easily be used in dashboards, anomaly detection, and automations.</p>
<p><a href="https://docs.dynatrace.com/docs/platform/openpipeline/use-cases/tutorial-log-processing-pipeline" target="_blank">Metric Extraction Documentation</a></p>
<p>Query the new dropped data points / signals metric extracted by Dynatrace OpenPipeline, using the <code>timeseries</code> command.</p>
<p>DQL: Extracted metrics: dropped data points / signals
<div class="highlight"><pre><span></span><code><span class="n">timeseries</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="n">dropped_items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="n">log</span><span class="p">.</span><span class="n">otelcol_exporter_dropped_items_by_signal</span><span class="p">,</span><span class="w"> </span><span class="k">default</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="err">}</span><span class="p">,</span><span class="w"> </span><span class="k">by</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="n">k8s</span><span class="p">.</span><span class="k">cluster</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">collector</span><span class="p">,</span><span class="w"> </span><span class="n">signal</span><span class="err">}</span>
</code></pre></div></p>
<p>Result:</p>
<p><img alt="Drop Metric" src="../img/dt_opp-otel_collector_analyze_query_drops_metric.png" /></p>
<p>You likely won't have any data matching your query as you shouldn't have data drops.  You can force data drops by toggling your Dynatrace API Access Token off for a couple minutes and then turning it back on.</p>
<p><img alt="Toggle Token" src="../img/dt_opp-otel_collector_toggle_token.png" /></p>
<h3 id="opentelemetry-collector-dashboard">OpenTelemetry Collector Dashboard<a class="headerlink" href="#opentelemetry-collector-dashboard" title="Permanent link">#</a></h3>
<p><strong>Import Dashboard into Dynatrace</strong></p>
<p><a href="https://github.com/dynatrace-wwse/enablement-kubernetes-opentelemetry-openpipeline/blob/main/assets/dynatrace/dashboards/opentelemetry-collector-health-openpipeline.json" target="_blank">OpenTelemetry Collector Dashboard</a></p>
<p>Explore the OpenTelemetry Collector [IsItObservable] - OpenPipeline Dashboard that you imported.</p>
<p><img alt="OpenTelemetry Collector Dashboard" src="../img/dt_opp-otel_collector_analyze_collector_dashboard.png" /></p>
<h2 id="wrap-up">Wrap Up<a class="headerlink" href="#wrap-up" title="Permanent link">#</a></h2>
<p><strong>What You Learned Today</strong></p>
<p>By completing this module, you've successfully set up Dynatrace OpenPipeline pipelines to process the OpenTelemetry logs at ingest.</p>
<ul>
<li>OpenTelemetry Collector logs<ul>
<li>Parse JSON structured content field to easily filter, aggregate, and analyze on nested fields</li>
<li>Set loglevel and status fields to easily identify errors with the OpenTelemetry Collector</li>
<li>Remove unwanted fields/attributes to reduce log bloat and optimize queries</li>
<li>Extract metrics: successful data points to track OpenTelemetry Collector health and reduce heavy log queries</li>
<li>Extract metrics: dropped data points to track OpenTelemetry Collector health and reduce heavy log queries</li>
<li>Alert: zero data points to be alerted on OpenTelemetry Collector health issues</li>
</ul>
</li>
</ul>
<h2 id="continue">Continue<a class="headerlink" href="#continue" title="Permanent link">#</a></h2>
<div class="grid cards">
<ul>
<li><a href="../7-dynatrace-openpipeline-astronomy-shop-logs/">Continue to Configuring OpenPipeline for Astronomy Shop logs<span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span></a></li>
</ul>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy"], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>