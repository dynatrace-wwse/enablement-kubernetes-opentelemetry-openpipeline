
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../8-dynatrace-openpipeline-astronomy-shop-logs/">
      
      
        <link rel="next" href="../cleanup/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.42">
    
    
      
        <title>9. Dynatrace OpenPipeline Kubernetes Events - Dynatrace Enablement Lab: OpenTelemetry Logs and OpenPipeline</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
  <!-- Add scripts that need to run before here -->
  
      
    
  <!-- Add scripts that need to run afterwards here -->
   Create an agentless RUM application before GoLive
   <!-- TODO: BeforeGoLive: Replace Agentless RUM Snippet
    1. Create an agentless application in Dynatrace from with convention 'dynatrace-wwse/repositoryname'
    2. https://hci34192.apps.dynatrace.com/ui/apps/dynatrace.classic.deploy.agentless/#install/agentless;gtf=-2h;gf=all
    <script type="text/javascript" src="https://js-cdn.dynatrace.com/jstag/PLACEHOLDEr/REPLACE_WITH_YOUR_SNIPPET/1234abcd1234abcd_complete.js" crossorigin="anonymous"></script>
    -->
    <script type="text/javascript" src="https://js-cdn.dynatrace.com/jstag/145e12d594f/bf64904yne/6c910e7a6d2a6ab4_complete.js" crossorigin="anonymous"></script>

    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#dynatrace-openpipeline-kubernetes-events" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Dynatrace Enablement Lab: OpenTelemetry Logs and OpenPipeline" class="md-header__button md-logo" aria-label="Dynatrace Enablement Lab: OpenTelemetry Logs and OpenPipeline" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Dynatrace Enablement Lab: OpenTelemetry Logs and OpenPipeline
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              9. Dynatrace OpenPipeline Kubernetes Events
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/dynatrace-wwse/enablement-kubernetes-opentelemetry-openpipeline" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    View Code on GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Dynatrace Enablement Lab: OpenTelemetry Logs and OpenPipeline" class="md-nav__button md-logo" aria-label="Dynatrace Enablement Lab: OpenTelemetry Logs and OpenPipeline" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Dynatrace Enablement Lab: OpenTelemetry Logs and OpenPipeline
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/dynatrace-wwse/enablement-kubernetes-opentelemetry-openpipeline" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    View Code on GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. About
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../2-getting-started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Getting started
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../3-codespaces/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Codespaces
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../4-opentelemetry-logs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. OpenTelemetry Logs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../5-opentelemetry-capstone/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. OpenTelemetry Capstone
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../6-dynatrace-buckets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. Dynatrace Buckets
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../7-dynatrace-openpipeline-collector-logs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7. Dynatrace OpenPipeline Collector Logs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../8-dynatrace-openpipeline-astronomy-shop-logs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8. Dynatrace OpenPipeline Astronomy Shop Logs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    9. Dynatrace OpenPipeline Kubernetes Events
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    9. Dynatrace OpenPipeline Kubernetes Events
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#generate-kubernetes-events" class="md-nav__link">
    <span class="md-ellipsis">
      Generate Kubernetes Events
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#query-logs" class="md-nav__link">
    <span class="md-ellipsis">
      Query Logs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Query Logs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kubernetes-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Kubernetes Attributes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-replicaset" class="md-nav__link">
    <span class="md-ellipsis">
      Kubernetes ReplicaSet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-pod" class="md-nav__link">
    <span class="md-ellipsis">
      Kubernetes Pod
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#content-field-and-drop-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Content Field and Drop Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opentelemetry-service-name-and-namespace" class="md-nav__link">
    <span class="md-ellipsis">
      OpenTelemetry Service Name and Namespace
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-openpipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Configure OpenPipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configure OpenPipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kubernetes-attributes_1" class="md-nav__link">
    <span class="md-ellipsis">
      Kubernetes Attributes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-replicaset_1" class="md-nav__link">
    <span class="md-ellipsis">
      Kubernetes ReplicaSet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-pod_1" class="md-nav__link">
    <span class="md-ellipsis">
      Kubernetes Pod
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loglevel-and-status" class="md-nav__link">
    <span class="md-ellipsis">
      Loglevel and Status
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#content-field" class="md-nav__link">
    <span class="md-ellipsis">
      Content Field
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Remove Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opentelemetry-service-name" class="md-nav__link">
    <span class="md-ellipsis">
      OpenTelemetry Service Name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opentelemetry-service-namespace" class="md-nav__link">
    <span class="md-ellipsis">
      OpenTelemetry Service Namespace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-event-count" class="md-nav__link">
    <span class="md-ellipsis">
      Kubernetes Event Count
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storage" class="md-nav__link">
    <span class="md-ellipsis">
      Storage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-route" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamic Route
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyze-results" class="md-nav__link">
    <span class="md-ellipsis">
      Analyze Results
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Analyze Results">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generate-kubernetes-events_1" class="md-nav__link">
    <span class="md-ellipsis">
      Generate Kubernetes Events
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#analyze-the-results-in-dynatrace-notebook" class="md-nav__link">
    <span class="md-ellipsis">
      Analyze the results in Dynatrace (Notebook)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wrap-up" class="md-nav__link">
    <span class="md-ellipsis">
      Wrap Up
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#continue" class="md-nav__link">
    <span class="md-ellipsis">
      Continue
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cleanup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    10. Cleanup
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#generate-kubernetes-events" class="md-nav__link">
    <span class="md-ellipsis">
      Generate Kubernetes Events
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#query-logs" class="md-nav__link">
    <span class="md-ellipsis">
      Query Logs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Query Logs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kubernetes-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Kubernetes Attributes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-replicaset" class="md-nav__link">
    <span class="md-ellipsis">
      Kubernetes ReplicaSet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-pod" class="md-nav__link">
    <span class="md-ellipsis">
      Kubernetes Pod
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#content-field-and-drop-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Content Field and Drop Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opentelemetry-service-name-and-namespace" class="md-nav__link">
    <span class="md-ellipsis">
      OpenTelemetry Service Name and Namespace
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-openpipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Configure OpenPipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configure OpenPipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kubernetes-attributes_1" class="md-nav__link">
    <span class="md-ellipsis">
      Kubernetes Attributes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-replicaset_1" class="md-nav__link">
    <span class="md-ellipsis">
      Kubernetes ReplicaSet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-pod_1" class="md-nav__link">
    <span class="md-ellipsis">
      Kubernetes Pod
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loglevel-and-status" class="md-nav__link">
    <span class="md-ellipsis">
      Loglevel and Status
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#content-field" class="md-nav__link">
    <span class="md-ellipsis">
      Content Field
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-fields" class="md-nav__link">
    <span class="md-ellipsis">
      Remove Fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opentelemetry-service-name" class="md-nav__link">
    <span class="md-ellipsis">
      OpenTelemetry Service Name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opentelemetry-service-namespace" class="md-nav__link">
    <span class="md-ellipsis">
      OpenTelemetry Service Namespace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernetes-event-count" class="md-nav__link">
    <span class="md-ellipsis">
      Kubernetes Event Count
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storage" class="md-nav__link">
    <span class="md-ellipsis">
      Storage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-route" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamic Route
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyze-results" class="md-nav__link">
    <span class="md-ellipsis">
      Analyze Results
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Analyze Results">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generate-kubernetes-events_1" class="md-nav__link">
    <span class="md-ellipsis">
      Generate Kubernetes Events
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#analyze-the-results-in-dynatrace-notebook" class="md-nav__link">
    <span class="md-ellipsis">
      Analyze the results in Dynatrace (Notebook)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wrap-up" class="md-nav__link">
    <span class="md-ellipsis">
      Wrap Up
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#continue" class="md-nav__link">
    <span class="md-ellipsis">
      Continue
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="dynatrace-openpipeline-kubernetes-events">Dynatrace OpenPipeline - Kubernetes Events<a class="headerlink" href="#dynatrace-openpipeline-kubernetes-events" title="Permanent link">#</a></h1>
<script>
document.addEventListener('DOMContentLoaded', function() {
  dynatrace.sendBizEvent('page_load', {"page": "9. Dynatrace OpenPipeline Kubernetes Events"})
});
</script>

<p>In this module we'll utilize Dynatrace OpenPipeline to process Kubernetes Events at ingest, in order to make them easier to analyze and leverage.  The events will be ingested by OpenTelemetry Collector as logs, deployed on Kubernetes as part of the previous module.  With OpenPipeline, the logs will be processed at ingest, to manipulate fields, extract metrics, and raise alert events in case of any issues.</p>
<p>The OpenTelemetry Collector, specifically the Contrib Distro running as a Deployment, is configured to capture Kubernetes Events using the <code>k8s_objects</code> receiver.  These events are shipped to Dynatrace as OpenTelemetry logs.  While these logs contain a lot of useful information, they are missing valuable fields/attributes that will make them easier to analyze in context.  These logs can be enriched at ingest, using OpenPipeline.  Additionally, OpenPipeline allows us to process fields, extract new data types, manage permissions, and modify storage retention.</p>
<p><strong>Goals:</strong></p>
<ul>
<li>Enrich logs with additional Kubernetes metadata</li>
<li>Enrich the log message, via the content field</li>
<li>Set loglevel and status fields</li>
<li>Remove unwanted fields/attributes</li>
<li>Add OpenTelemetry service name and namespace</li>
<li>Extract metrics: event count</li>
<li>Storage retention with bucket assignment</li>
</ul>
<p><img alt="OpenPipeline" src="../img/dt_opp_mrkt_header.png" /></p>
<p>OpenPipeline is an architectural component of Dynatrace SaaS.  It resides between the Dynatrace SaaS tenant and <a href="https://docs.dynatrace.com/docs/discover-dynatrace/platform/grail/dynatrace-grail">Grail</a> data lakehouse.  Logs (,traces, metrics, events, and more) are sent to the Dynatrace SaaS tenant and route through OpenPipeline where they are enriched, transformed, and contextualized prior to being stored in Grail.</p>
<div class="grid cards">
<ul>
<li><a href="https://docs.dynatrace.com/docs/discover-dynatrace/platform/openpipeline/concepts/data-flow" target="_blank">Learn More<span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span></a></li>
</ul>
</div>
<h2 id="generate-kubernetes-events">Generate Kubernetes Events<a class="headerlink" href="#generate-kubernetes-events" title="Permanent link">#</a></h2>
<p>Kubernetes Events will only be generated when Kubernetes orchestration causes changes within the environment.  Generate new Kubernetes Events for analysis prior to continuing.</p>
<p>Command:
<div class="highlight"><pre><span></span><code>kubectl delete pods -n astronomy-shop --field-selector=&quot;status.phase=Running&quot;
</code></pre></div></p>
<p>This will delete all running pods for <code>astronomy-shop</code> and schedule new ones, resulting in many new Kubernetes Events.</p>
<h2 id="query-logs">Query Logs<a class="headerlink" href="#query-logs" title="Permanent link">#</a></h2>
<p>Query and discover the Kubernetes Events logs as they are ingested and stored in Dynatrace.  Use Dynatrace Query Language (DQL) to transform the logs at query time and prepare for Dynatrace OpenPipeline configuration.</p>
<p><strong>Import Notebook into Dynatrace</strong></p>
<p><a href="https://github.com/dynatrace-wwse/enablement-kubernetes-opentelemetry-openpipeline/blob/main/assets/dynatrace/notebooks/opentelemetry-kubernetes-events.json" target="_blank">Download Kubernetes Events Logs Notebook</a></p>
<p><strong>Kubernetes Events - Ondemand Processing at Query Time (Notebook)</strong></p>
<h3 id="kubernetes-attributes">Kubernetes Attributes<a class="headerlink" href="#kubernetes-attributes" title="Permanent link">#</a></h3>
<p>When the OpenTelemetry Collector captures Kubernetes Events using the <code>k8s_objects</code> receiver, most of the Kubernetes context information is stored in fields with the prefix <code>object.*</code> and <code>object.involvedObject.*</code>.  These fields aren't used in other logs related to Kubernetes observability.  Dynatrace OpenPipeline enables us to parse these object fields and use them to populate the normal Kubernetes (<code>k8s.*</code>) attributes.</p>
<div class="admonition warning">
<p class="admonition-title">Field Name Casing</p>
<p>In some cases, it has been observed that the fields that should start with <code>object.involvedObject.*</code> are instead starting with <code>object.involvedobject.*</code>.  When using field names with DQL, the proper case needs to be used.  If you encounter this, please match the casing you observe in your environment.</p>
</div>
<p>Query the Kubernetes logs filtered on <code>event.domain == "k8s"</code> and <code>telemetry.sdk.name</code>.</p>
<p>DQL: Before OpenPipeline and DQL Transformation
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;opentelemetry&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="k">domain</span><span class="p">,</span><span class="ss">&quot;k8s&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">resource</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;events&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">namespace</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">kind</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">25</span>
</code></pre></div></p>
<p><img alt="Kubernetes Attributes Pre" src="../img/dt_opp-k8s_events_attributes_dql_pre.png" /></p>
<p>Notice the many fields with the <code>object.*</code> prefix that provide valuable context information about the Kubernetes component related to the event.  Use the <code>object.involvedObject.namespace</code>, <code>object.involvedObject.kind</code>, and <code>object.involvedObject.name</code> fields to set the Kubernetes (<code>k8s.*</code>) attributes.</p>
<p>Use DQL to transform the logs and apply the <code>k8s.*</code> attributes.</p>
<p>DQL: After DQL Transformation
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;opentelemetry&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="k">domain</span><span class="p">,</span><span class="ss">&quot;k8s&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">resource</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;events&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">namespace</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">kind</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">25</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsAdd</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">namespace</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsAdd</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">pod</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">kind</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;Pod&quot;</span><span class="p">,</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsAdd</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">kind</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;Deployment&quot;</span><span class="p">,</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsAdd</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">replicaset</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">kind</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;ReplicaSet&quot;</span><span class="p">,</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">replicaset</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">pod</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">kind</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">name</span>
</code></pre></div></p>
<p><img alt="Kubernetes Attributes Post" src="../img/dt_opp-k8s_events_attributes_dql_post.png" /></p>
<p>These changes with DQL allow us to populate the relevant Kubernetes attributes where we know the correct value.  For example, if the involved object is a Deployment, then we can set the <code>k8s.deployment.name</code> attribute.  In order to populate the missing fields, we can apply logic and DQL parsing commands.</p>
<h3 id="kubernetes-replicaset">Kubernetes ReplicaSet<a class="headerlink" href="#kubernetes-replicaset" title="Permanent link">#</a></h3>
<p>For the Kubernetes Events that impact a ReplicaSet, we need to set the <code>k8s.replicaset.name</code> and <code>k8s.deployment.name</code>.  Since the event doesn't directly impact a Pod and we don't know the Pod unique id, the <code>k8s.pod.name</code> attribute should remain <code>null</code>.</p>
<p>Query the Kubernetes logs filtered on <code>object.involvedObject.kind == "ReplicaSet"</code>.</p>
<p>DQL: Before OpenPipeline and DQL Transformation
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;opentelemetry&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="k">domain</span><span class="p">,</span><span class="ss">&quot;k8s&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">resource</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;events&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">namespace</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">kind</span><span class="p">,</span><span class="ss">&quot;ReplicaSet&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">25</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">replicaset</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">pod</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">kind</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">name</span>
</code></pre></div></p>
<p><img alt="Kubernetes ReplicaSet Pre" src="../img/dt_opp-k8s_events_replicaset_dql_pre.png" /></p>
<p>The ReplicaSet name follows the naming convention <code>&lt;deployment-name&gt;-&lt;replicaset-hash&gt;</code>.  Use DQL to transform the logs, parse the ReplicaSet name, and apply the value ot the <code>k8s.deployment.name</code> attribute.</p>
<p>DQL: After DQL Transformation
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;opentelemetry&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="k">domain</span><span class="p">,</span><span class="ss">&quot;k8s&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">resource</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;events&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">namespace</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">kind</span><span class="p">,</span><span class="ss">&quot;ReplicaSet&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">25</span>
<span class="o">|</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;LD:deployment (&#39;-&#39; ALNUM:hash EOS)&quot;</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsAdd</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">deployment</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">replicaset</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">pod</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">kind</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">name</span>
</code></pre></div></p>
<p><img alt="Kubernetes ReplicaSet Post" src="../img/dt_opp-k8s_events_replicaset_dql_post.png" /></p>
<p>This modifies the log attributes at query time and helps us identify the processing rules for Dynatrace OpenPipeline.  We'll validate the results after OpenPipeline, later.</p>
<h3 id="kubernetes-pod">Kubernetes Pod<a class="headerlink" href="#kubernetes-pod" title="Permanent link">#</a></h3>
<p>For the Kubernetes Events that impact a Pod, we need to set the <code>k8s.pod.name</code>, <code>k8s.replicaset.name</code> and <code>k8s.deployment.name</code> since we know all (3).</p>
<p>Query the Kubernetes logs filtered on <code>object.involvedObject.kind == "Pod"</code>.</p>
<p>DQL: Before OpenPipeline and DQL Transformation
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;opentelemetry&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="k">domain</span><span class="p">,</span><span class="ss">&quot;k8s&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">resource</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;events&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">namespace</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">kind</span><span class="p">,</span><span class="ss">&quot;Pod&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">25</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">replicaset</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">pod</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">kind</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">name</span>
</code></pre></div></p>
<p><img alt="Kubernetes Pod Pre" src="../img/dt_opp-k8s_events_pod_dql_pre.png" /></p>
<p>The Pod name follows the naming convention <code>&lt;deployment-name&gt;-&lt;replicaset-hash&gt;-&lt;pod-hash&gt;</code>.  Use DQL to transform the logs, parse the Pod name, and apply the value ot the <code>k8s.deployment.name</code> and <code>k8s.replicaset.name</code> attributes.</p>
<p>DQL: After DQL Transformation
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;opentelemetry&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="k">domain</span><span class="p">,</span><span class="ss">&quot;k8s&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">resource</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;events&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">namespace</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">kind</span><span class="p">,</span><span class="ss">&quot;Pod&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">25</span>
<span class="o">|</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;LD:deployment (&#39;-&#39; ALNUM:hash &#39;-&#39; ALNUM:unique EOS)&quot;</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsAdd</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">deployment</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsAdd</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">replicaset</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">concat</span><span class="p">(</span><span class="n">deployment</span><span class="p">,</span><span class="ss">&quot;-&quot;</span><span class="p">,</span><span class="n">hash</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">replicaset</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">pod</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">kind</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">name</span>
</code></pre></div></p>
<p><img alt="Kubernetes Pod Post" src="../img/dt_opp-k8s_events_pod_dql_post.png" /></p>
<p>This modifies the log attributes at query time and helps us identify the processing rules for Dynatrace OpenPipeline.  We'll validate the results after OpenPipeline, later.</p>
<h3 id="content-field-and-drop-fields">Content Field and Drop Fields<a class="headerlink" href="#content-field-and-drop-fields" title="Permanent link">#</a></h3>
<p>The <code>content</code> field is a standard semantic attribute/field for log data.  Best practice is to have a populated content field, as the minimum fields necessary for log analysis are timestamp and content.  For the Kubernetes Events, the content field is null.  There are other fields on the logs that can be used to populate the content field, <code>object.reason</code> and <code>object.message</code> are the best candidates.</p>
<p>Additionally, there are several fields with the <code>object.metadata.*</code> prefix which provide little to no value.  These fields add log bloat, consuming unnecessary storage and increasing query response times (albeit negligbly).</p>
<p>Query the Kubernetes logs focused on these attributes.</p>
<p>DQL: Before OpenPipeline and DQL Transformation
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;opentelemetry&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="k">domain</span><span class="p">,</span><span class="ss">&quot;k8s&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">resource</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;events&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">namespace</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">kind</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">25</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">reason</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="n">managedfields</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="n">uid</span>
</code></pre></div></p>
<p><img alt="Content Field Pre" src="../img/dt_opp-k8s_events_content_dql_pre.png" /></p>
<p>We can use the <code>object.reason</code> and <code>object.message</code> fields together to create a valuable <code>content</code> field.  The <code>object.metadata.managedfields</code>, <code>object.metadata.name</code>, and <code>object.metadata.uid</code> fields are redudant or useless, they can be removed.</p>
<p>Use DQL to transform the logs, set the <code>content</code> field and remove the useless fields.</p>
<p>DQL: After DQL Transformation
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;opentelemetry&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="k">domain</span><span class="p">,</span><span class="ss">&quot;k8s&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">resource</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;events&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">namespace</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">kind</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">content</span><span class="p">,</span><span class="ss">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">content</span><span class="p">,</span><span class="ss">&quot; &quot;</span><span class="p">)</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="k">isNull</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">25</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsAdd</span><span class="w"> </span><span class="n">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="k">isNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">reason</span><span class="p">),</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="k">else</span><span class="p">:</span><span class="n">concat</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">reason</span><span class="p">,</span><span class="ss">&quot;: &quot;</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">message</span><span class="p">))</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsAdd</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="n">uid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="n">managedfields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">reason</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="n">managedfields</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="n">uid</span>
</code></pre></div></p>
<p><img alt="Content Field Post" src="../img/dt_opp-k8s_events_content_dql_post.png" /></p>
<p>This modifies the log attributes at query time and helps us identify the processing rules for Dynatrace OpenPipeline.  We'll validate the results after OpenPipeline, later.</p>
<h3 id="opentelemetry-service-name-and-namespace">OpenTelemetry Service Name and Namespace<a class="headerlink" href="#opentelemetry-service-name-and-namespace" title="Permanent link">#</a></h3>
<p>In OpenTelemetry, <code>service.name</code> and <code>service.namespace</code> are used to provide meaningful context about the services generating telemetry data:</p>
<p><code>service.name</code>: This is the logical name of the service. It should be the same for all instances of a horizontally scaled service. For example, if you have a shopping cart service, you might name it shoppingcart.</p>
<p><code>service.namespace</code>: This is used to group related services together. It helps distinguish a group of services that logically belong to the same system or team. For example, you might use Shop as the namespace for all services related to an online store.</p>
<p>These attributes help in organizing and identifying telemetry data, making it easier to monitor and troubleshoot services within a complex system.</p>
<p>The logs for the Kubernetes Events do not include these fields.   In order to make it easier to analyze the log files and unify the telemetry, the <code>service.name</code> and <code>service.namespace</code> attributes should be added with Dynatrace OpenPipeline.</p>
<p>Query the Kubernetes logs for <code>astronomy-shop</code>.</p>
<p>DQL: Before OpenPipeline and DQL Transformation
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;opentelemetry&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="k">domain</span><span class="p">,</span><span class="ss">&quot;k8s&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">resource</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;events&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">namespace</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">kind</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;astronomy-shop&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">25</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="n">namespace</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">name</span>
</code></pre></div></p>
<p><img alt="OpenTelemetry Service Name Pre" src="../img/dt_opp-k8s_events_service_dql_pre.png" /></p>
<p>The <code>k8s.deployment.name</code> can be split to obtain the <code>service.name</code> field.  Unfortunately, the <code>service.namespace</code> value does not exist anywhere on the event.  This value will need to be set as a static string.  Use the value that you set in the <code>$NAME</code> variable earlier, in the form <code>&lt;INITIALS&gt;-k8s-otel-o11y</code>.</p>
<p>Use DQL to transform the logs, set the <code>service.name</code> and <code>service.namespace</code> fields.</p>
<p>DQL: After DQL Transformation
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;opentelemetry&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="k">domain</span><span class="p">,</span><span class="ss">&quot;k8s&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">resource</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;events&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">namespace</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">kind</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;astronomy-shop&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">kind</span><span class="p">,</span><span class="ss">&quot;Deployment&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">25</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsAdd</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">name</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsAdd</span><span class="w"> </span><span class="n">split_deployment_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">splitString</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="n">split_deployment_name</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="ss">&quot;(PUNCT?) WORD:service.name&quot;</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsRemove</span><span class="w"> </span><span class="n">split_deployment_name</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsAdd</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="n">namespace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;&lt;INITIALS&gt;-k8s-otel-o11y&quot;</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="n">namespace</span>
</code></pre></div>
<em>Be sure to replace <code>&lt;INITIALS&gt;</code> with the correct value in your query!</em></p>
<p><img alt="OpenTelemetry Service Name Post" src="../img/dt_opp-k8s_events_service_dql_post.png" /></p>
<p>This modifies the log attributes at query time and helps us identify the processing rules for Dynatrace OpenPipeline.  We'll validate the results after OpenPipeline, <em>next</em>.</p>
<h2 id="configure-openpipeline">Configure OpenPipeline<a class="headerlink" href="#configure-openpipeline" title="Permanent link">#</a></h2>
<p>Configure Dynatrace OpenPipeline for Kubernetes Events logs.</p>
<div class="admonition tip">
<p class="admonition-title">View Images</p>
<p>If the images are too small and the text is difficult to read, right-click and open the image in a new tab.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Save Often</p>
<p>Consider saving your pipeline configuration often to avoid losing any changes.</p>
</div>
<p>In your Dynatrace tenant, launch the OpenPipeline app.  Begin by selecting <code>Logs</code> from the left-hand menu of telemetry types.  Then choose <code>Pipelines</code>.  Click on <code>+ Pipeline</code> to add a new pipeline.</p>
<p><img alt="Add Pipeline" src="../img/dt_opp-k8s_events_opp_add_pipeline.png" /></p>
<p>Name the new pipeline, <code>OpenTelemetry Kubernetes Events</code>.  Click on the <code>Processing</code> tab to begin adding <code>Processor</code> rules.</p>
<p><img alt="Name Pipeline" src="../img/dt_opp-k8s_events_opp_name_pipeline.png" /></p>
<h3 id="kubernetes-attributes_1">Kubernetes Attributes<a class="headerlink" href="#kubernetes-attributes_1" title="Permanent link">#</a></h3>
<p>Add a processor to set the Kubernetes Attributes.  Click on <code>+ Processor</code> to add a new processor.</p>
<p>Type:
<div class="highlight"><pre><span></span><code>DQL
</code></pre></div></p>
<p>Name:
<div class="highlight"><pre><span></span><code>Kubernetes Attributes
</code></pre></div></p>
<p>Matching condition:
<div class="highlight"><pre><span></span><code>isNotNull(object.involvedObject.namespace) and isNotNull(object.involvedObject.kind) and isNotNull(object.involvedObject.name)
</code></pre></div></p>
<p>Processor definition:
<div class="highlight"><pre><span></span><code>fieldsAdd k8s.namespace.name = object.involvedObject.namespace
| fieldsAdd k8s.pod.name = if(object.involvedObject.kind == &quot;Pod&quot;,object.involvedObject.name)
| fieldsAdd k8s.deployment.name = if(object.involvedObject.kind == &quot;Deployment&quot;,object.involvedObject.name)
| fieldsAdd k8s.replicaset.name = if(object.involvedObject.kind == &quot;ReplicaSet&quot;,object.involvedObject.name)
</code></pre></div></p>
<p><img alt="Kubernetes Attributes" src="../img/dt_opp-k8s_events_opp_dql_k8s_attributes.png" /></p>
<h3 id="kubernetes-replicaset_1">Kubernetes ReplicaSet<a class="headerlink" href="#kubernetes-replicaset_1" title="Permanent link">#</a></h3>
<p>Add a processor to set the values for Kubernetes ReplicaSet.  Click on <code>+ Processor</code> to add a new processor.</p>
<p>Type:
<div class="highlight"><pre><span></span><code>DQL
</code></pre></div></p>
<p>Name:
<div class="highlight"><pre><span></span><code>Kubernetes ReplicaSet
</code></pre></div></p>
<p>Matching condition:
<div class="highlight"><pre><span></span><code>isNotNull(object.involvedObject.namespace) and isNotNull(object.involvedObject.name) and matchesValue(object.involvedObject.kind,&quot;ReplicaSet&quot;)
</code></pre></div></p>
<p>Processor definition:
<div class="highlight"><pre><span></span><code>parse object.involvedObject.name, &quot;LD:deployment (&#39;-&#39; ALNUM:hash EOS)&quot;
| fieldsAdd k8s.deployment.name = deployment
| fieldsRemove deployment, hash
</code></pre></div></p>
<p><img alt="Kubernetes ReplicaSet" src="../img/dt_opp-k8s_events_opp_dql_k8s_replicaset.png" /></p>
<h3 id="kubernetes-pod_1">Kubernetes Pod<a class="headerlink" href="#kubernetes-pod_1" title="Permanent link">#</a></h3>
<p>Add a processor to set the values for Kubernetes Pod.  Click on <code>+ Processor</code> to add a new processor.</p>
<p>Type:
<div class="highlight"><pre><span></span><code>DQL
</code></pre></div></p>
<p>Name:
<div class="highlight"><pre><span></span><code>Kubernetes Pod
</code></pre></div></p>
<p>Matching condition:
<div class="highlight"><pre><span></span><code>isNotNull(object.involvedObject.namespace) and isNotNull(object.involvedObject.name) and matchesValue(object.involvedObject.kind,&quot;Pod&quot;)
</code></pre></div></p>
<p>Processor definition:
<div class="highlight"><pre><span></span><code>parse object.involvedObject.name, &quot;LD:deployment (&#39;-&#39; ALNUM:hash &#39;-&#39; ALNUM:unique EOS)&quot;
| fieldsAdd k8s.deployment.name = deployment
| fieldsAdd k8s.replicaset.name = concat(deployment,&quot;-&quot;,hash)
| fieldsRemove deployment, hash, unique
</code></pre></div></p>
<p><img alt="Kubernetes Pod" src="../img/dt_opp-k8s_events_opp_dql_k8s_pod.png" /></p>
<h3 id="loglevel-and-status">Loglevel and Status<a class="headerlink" href="#loglevel-and-status" title="Permanent link">#</a></h3>
<p>Add a processor to set the Loglevel and Status fields.  Click on <code>+ Processor</code> to add a new processor.</p>
<p>Type:
<div class="highlight"><pre><span></span><code>DQL
</code></pre></div></p>
<p>Name:
<div class="highlight"><pre><span></span><code>Loglevel and Status
</code></pre></div></p>
<p>Matching condition:
<div class="highlight"><pre><span></span><code>isNotNull(object.type) and (isNull(loglevel) or matchesValue(loglevel,&quot;NONE&quot;)) and (isNull(status) or matchesValue(status,&quot;NONE&quot;))
</code></pre></div></p>
<p>Processor definition:
<div class="highlight"><pre><span></span><code>fieldsAdd loglevel = if(matchesValue(object.type,&quot;Normal&quot;),&quot;INFO&quot;, else: if(matchesValue(object.type,&quot;Warning&quot;),&quot;WARN&quot;, else: &quot;NONE&quot;))
| fieldsAdd status = if(matchesValue(object.type,&quot;Normal&quot;),&quot;INFO&quot;, else: if(matchesValue(object.type,&quot;Warning&quot;),&quot;WARN&quot;, else: &quot;NONE&quot;))
</code></pre></div></p>
<p><img alt="Loglevel and Status" src="../img/dt_opp-k8s_events_opp_dql_loglevel.png" /></p>
<h3 id="content-field">Content Field<a class="headerlink" href="#content-field" title="Permanent link">#</a></h3>
<p>Add a processor to set the content field.  Click on <code>+ Processor</code> to add a new processor.</p>
<p>Type:
<div class="highlight"><pre><span></span><code>DQL
</code></pre></div></p>
<p>Name:
<div class="highlight"><pre><span></span><code>Content Field
</code></pre></div></p>
<p>Matching condition:
<div class="highlight"><pre><span></span><code>(matchesValue(content,&quot;&quot;) or matchesValue(content,&quot; &quot;) or isNull(content)) and isNotNull(object.message)
</code></pre></div></p>
<p>Processor definition:
<div class="highlight"><pre><span></span><code>fieldsAdd content = if(isNull(object.reason), object.message, else:concat(object.reason,&quot;: &quot;, object.message))
</code></pre></div></p>
<p><img alt="Content Field" src="../img/dt_opp-k8s_events_opp_dql_content.png" /></p>
<h3 id="remove-fields">Remove Fields<a class="headerlink" href="#remove-fields" title="Permanent link">#</a></h3>
<p>Add a processor to drop the redudant and unnecessary.  Click on <code>+ Processor</code> to add a new processor.</p>
<p>Type:
<div class="highlight"><pre><span></span><code>Remove Fields
</code></pre></div></p>
<p>Name:
<div class="highlight"><pre><span></span><code>Drop Fields
</code></pre></div></p>
<p>Matching condition:
<div class="highlight"><pre><span></span><code>isNotNull(object.involvedObject.namespace) and isNotNull(object.involvedObject.kind) and isNotNull(object.involvedObject.name)
</code></pre></div></p>
<p>Remove fields:</p>
<table>
<thead>
<tr>
<th>Fields</th>
</tr>
</thead>
<tbody>
<tr>
<td>object.metadata.name</td>
</tr>
<tr>
<td>object.metadata.uid</td>
</tr>
<tr>
<td>object.metadata.managedFields</td>
</tr>
</tbody>
</table>
<p><img alt="Drop Fields" src="../img/dt_opp-k8s_events_opp_dql_drop_fields.png" /></p>
<h3 id="opentelemetry-service-name">OpenTelemetry Service Name<a class="headerlink" href="#opentelemetry-service-name" title="Permanent link">#</a></h3>
<p>Add a processor to set the OpenTelemetry Service Name.  Click on <code>+ Processor</code> to add a new processor.</p>
<p>Type:
<div class="highlight"><pre><span></span><code>DQL
</code></pre></div></p>
<p>Name:
<div class="highlight"><pre><span></span><code>OpenTelemetry Service Name
</code></pre></div></p>
<p>Matching condition:
<div class="highlight"><pre><span></span><code>matchesValue(k8s.namespace.name,&quot;astronomy-shop&quot;) and isNotNull(k8s.deployment.name) and isNull(service.name)
</code></pre></div></p>
<p>Processor definition:
<div class="highlight"><pre><span></span><code>fieldsAdd split_deployment_name = splitString(k8s.deployment.name,k8s.namespace.name)
| parse split_deployment_name[1], &quot;(PUNCT?) WORD:service.name&quot;
| fieldsRemove split_deployment_name
</code></pre></div></p>
<p><img alt="Service Name" src="../img/dt_opp-k8s_events_opp_service_name.png" /></p>
<h3 id="opentelemetry-service-namespace">OpenTelemetry Service Namespace<a class="headerlink" href="#opentelemetry-service-namespace" title="Permanent link">#</a></h3>
<p>Add a processor to set the OpenTelemetry Service Namespace.  Click on <code>+ Processor</code> to add a new processor.</p>
<p>Type:
<div class="highlight"><pre><span></span><code>Add Fields
</code></pre></div></p>
<p>Name:
<div class="highlight"><pre><span></span><code>OpenTelemetry Service Namespace
</code></pre></div></p>
<p>Matching condition:
<div class="highlight"><pre><span></span><code>matchesValue(k8s.namespace.name,&quot;astronomy-shop&quot;) and isNotNull(k8s.deployment.name) and isNotNull(service.name) and isNull(service.namespace)
</code></pre></div></p>
<p>Add fields:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>service.namespace</td>
<td>INITIALS-k8s-otel-o11y</td>
</tr>
</tbody>
</table>
<p><em>Be sure to use the same <code>service.namespace</code> value that you have used elsewhere in this lab!</em></p>
<p><img alt="Service Namespace" src="../img/dt_opp-k8s_events_opp_service_namespace.png" /></p>
<div class="admonition tip">
<p class="admonition-title">Save Often</p>
<p>Consider saving your pipeline configuration often to avoid losing any changes.</p>
</div>
<h3 id="kubernetes-event-count">Kubernetes Event Count<a class="headerlink" href="#kubernetes-event-count" title="Permanent link">#</a></h3>
<p>Switch to the <code>Metric Extraction</code> tab.</p>
<p>Add a processor to set extract a metric from the Kubernetes event logs.  Click on <code>+ Processor</code> to add a new processor.</p>
<p>Type:
<div class="highlight"><pre><span></span><code>Counter metric
</code></pre></div></p>
<p>Name:
<div class="highlight"><pre><span></span><code>Kubernetes Event Count
</code></pre></div></p>
<p>Matching condition:
<div class="highlight"><pre><span></span><code>isNotNull(k8s.cluster.name) and isNotNull(k8s.namespace.name) and isNotNull(status)
</code></pre></div></p>
<p>Metric key:
<div class="highlight"><pre><span></span><code>otel.k8s.event_count
</code></pre></div></p>
<p>Dimensions:</p>
<table>
<thead>
<tr>
<th>Fields</th>
</tr>
</thead>
<tbody>
<tr>
<td>k8s.namespace.name</td>
</tr>
<tr>
<td>k8s.cluster.name</td>
</tr>
<tr>
<td>status</td>
</tr>
<tr>
<td>service.name</td>
</tr>
</tbody>
</table>
<p><img alt="Kubernetes Event Count" src="../img/dt_opp-k8s_events_opp_metric_event_count.png" /></p>
<div class="admonition tip">
<p class="admonition-title">Consider Saving</p>
<p>Consider saving your pipeline configuration often to avoid losing any changes.</p>
</div>
<h3 id="storage">Storage<a class="headerlink" href="#storage" title="Permanent link">#</a></h3>
<p>Switch to the <code>Storage</code> tab.</p>
<p>Add a processor to set the bucket assignment.  Click on <code>+ Processor</code> to add a new  <strong>Bucket Assignment</strong> processor.</p>
<p>Name:
<div class="highlight"><pre><span></span><code>Observe and Troubleshoot Apps Bucket
</code></pre></div></p>
<p>Matching condition:
<div class="highlight"><pre><span></span><code>matchesValue(k8s.namespace.name,&quot;astronomy-shop&quot;) and matchesValue(status,&quot;WARN&quot;)
</code></pre></div></p>
<p>Storage:
<div class="highlight"><pre><span></span><code>Observe and Troubleshoot Apps (95 Days)
</code></pre></div></p>
<p><img alt="Storage 95 Days" src="../img/dt_opp-k8s_events_opp_storage_95_days.png" /></p>
<p>This will result in Kubernetes Events logs with <code>WARN</code> status values that involve the <code>astronomy-shop</code> namespace matching this pipeline to be stored for 95 days in this bucket.</p>
<p>Add a processor to set the bucket assignment.  Click on <code>+ Processor</code> to add a new  <strong>Bucket Assignment</strong> processor.</p>
<p>Name:
<div class="highlight"><pre><span></span><code>Infrastructure Observability and AIOps Bucket
</code></pre></div></p>
<p>Matching condition:
<div class="highlight"><pre><span></span><code>isNotNull(status) and isNotNull(k8s.namespace.name)
</code></pre></div></p>
<p>Storage:
<div class="highlight"><pre><span></span><code>Infrastructure Observability and AIOps (365 Days)
</code></pre></div></p>
<p><img alt="Storage 365 Days" src="../img/dt_opp-k8s_events_opp_storage_365_days.png" /></p>
<p>This will result in any Kubernetes Events logs with a <code>status</code> field and <code>k8s.namespace.name</code> field matching this pipeline to be stored for 365 days in this bucket, <strong>if they did not match the previous processor</strong>.  Logs, or any other record type, processed through OpenPipeline can only be stored in one bucket.  The first matching processor is used to set the storage location.  </p>
<p>The pipeline is now configured, click on <code>Save</code> to save the pipeline configuration.</p>
<p><img alt="Save Pipeline" src="../img/dt_opp-k8s_events_opp_save_pipeline.png" /></p>
<h3 id="dynamic-route">Dynamic Route<a class="headerlink" href="#dynamic-route" title="Permanent link">#</a></h3>
<p>A pipeline will not have any effect unless logs are configured to be routed to the pipeline.  With dynamic routing, data is routed based on a matching condition. The matching condition is a DQL query that defines the data set you want to route.</p>
<p>Click on <code>Dynamic Routing</code> to configure a route to the target pipeline.  Click on <code>+ Dynamic Route</code> to add a new route.</p>
<p><img alt="Add Route" src="../img/dt_opp-k8s_events_opp_add_route.png" /></p>
<p>Configure the <code>Dynamic Route</code> to use the <code>OpenTelemetry Kubernetes Events</code> pipeline.</p>
<p>Name:
<div class="highlight"><pre><span></span><code>OpenTelemetry Kubernetes Events
</code></pre></div></p>
<p>Matching condition:
<div class="highlight"><pre><span></span><code>matchesValue(telemetry.sdk.name,&quot;opentelemetry&quot;) and matchesValue(event.domain,&quot;k8s&quot;) and matchesValue(k8s.resource.name,&quot;events&quot;)
</code></pre></div></p>
<p>Pipeline:
<div class="highlight"><pre><span></span><code>OpenTelemetry Kubernetes Events
</code></pre></div></p>
<p>Click <code>Add</code> to add the route.</p>
<p><img alt="Configure Route" src="../img/dt_opp-k8s_events_opp_configure_route.png" /></p>
<p>Validate that the route is enabled in the <code>Status</code> column.  Click on <code>Save</code> to save the dynamic route table configuration.</p>
<p><img alt="Save Routes" src="../img/dt_opp-k8s_events_opp_save_routes.png" /></p>
<p>Changes will typically take effect within a couple of minutes.</p>
<h2 id="analyze-results">Analyze Results<a class="headerlink" href="#analyze-results" title="Permanent link">#</a></h2>
<p>Analyze the Kubernetes Events logs after Dynatrace OpenPipeline processing.</p>
<h3 id="generate-kubernetes-events_1">Generate Kubernetes Events<a class="headerlink" href="#generate-kubernetes-events_1" title="Permanent link">#</a></h3>
<p>Kubernetes Events will only be generated when Kubernetes orchestration causes changes within the environment.  Generate new Kubernetes Events for analysis prior to continuing.</p>
<p>Command:
<div class="highlight"><pre><span></span><code>kubectl delete pods -n astronomy-shop --field-selector=&quot;status.phase=Running&quot;
</code></pre></div></p>
<p>This will delete all running pods for <code>astronomy-shop</code> and schedule new ones, resulting in many new Kubernetes Events.</p>
<h3 id="analyze-the-results-in-dynatrace-notebook">Analyze the results in Dynatrace (Notebook)<a class="headerlink" href="#analyze-the-results-in-dynatrace-notebook" title="Permanent link">#</a></h3>
<p>Use the Notebook from earlier to analyze the results.</p>
<p><strong>Kubernetes Attributes</strong></p>
<p>Query the Kubernetes Events logs fitered on <code>event.domain == "k8s"</code> to analyze with <code>Kubernetes Attributes</code>.</p>
<p>DQL: After OpenPipeline
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;opentelemetry&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="k">domain</span><span class="p">,</span><span class="ss">&quot;k8s&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">resource</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;events&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">namespace</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">kind</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">25</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">replicaset</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">pod</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">kind</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">name</span>
</code></pre></div></p>
<p><img alt="Kubernetes Attributes" src="../img/dt_opp-k8s_events_analyze_k8s_attributes.png" /></p>
<p><strong>Kubernetes ReplicaSet</strong></p>
<p>Query the Kubernetes Events logs fitered on <code>object.involvedObject.kind == "ReplicaSet"</code>.</p>
<p>DQL: After OpenPipeline
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;opentelemetry&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="k">domain</span><span class="p">,</span><span class="ss">&quot;k8s&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">resource</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;events&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">namespace</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">kind</span><span class="p">,</span><span class="ss">&quot;ReplicaSet&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">25</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">replicaset</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">pod</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">kind</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">name</span>
</code></pre></div></p>
<p><img alt="Kubernetes ReplicaSet" src="../img/dt_opp-k8s_events_analyze_k8s_replicaset.png" /></p>
<p><strong>Kubernetes Pod</strong></p>
<p>Query the Kubernetes Events logs fitered on <code>object.involvedObject.kind == "Pod"</code>.</p>
<p>DQL: After OpenPipeline
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;opentelemetry&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="k">domain</span><span class="p">,</span><span class="ss">&quot;k8s&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">resource</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;events&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">namespace</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">kind</span><span class="p">,</span><span class="ss">&quot;Pod&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">25</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">replicaset</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">pod</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">kind</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">name</span>
</code></pre></div></p>
<p><img alt="Kubernetes Pod" src="../img/dt_opp-k8s_events_analyze_k8s_pod.png" /></p>
<p><strong>Content Field and Drop Fields</strong></p>
<p>Query the Kubernetes Events logs to view the new <code>content</code> field.</p>
<p>DQL: After OpenPipeline
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;opentelemetry&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="k">domain</span><span class="p">,</span><span class="ss">&quot;k8s&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">resource</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;events&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">namespace</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">kind</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">25</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">reason</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">message</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="n">managedfields</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">object</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="n">uid</span>
</code></pre></div></p>
<p><img alt="Content Field" src="../img/dt_opp-k8s_events_analyze_content_reason.png" /></p>
<p><strong>OpenTelemetry Service Name and Namespace</strong></p>
<p>Query the Kubernetes Events logs filtered on <code>service.name</code> and <code>service.namespace</code>.</p>
<p>DQL: After OpenPipeline
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;opentelemetry&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="k">domain</span><span class="p">,</span><span class="ss">&quot;k8s&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">resource</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;events&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">namespace</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">kind</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="k">object</span><span class="p">.</span><span class="n">involvedObject</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;astronomy-shop&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="n">service</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">25</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="n">namespace</span><span class="p">,</span><span class="w"> </span><span class="n">content</span>
</code></pre></div></p>
<p><img alt="OpenTelemetry Service Name" src="../img/dt_opp-k8s_events_analyze_service_name.png" /></p>
<h2 id="wrap-up">Wrap Up<a class="headerlink" href="#wrap-up" title="Permanent link">#</a></h2>
<p><strong>What You Learned Today</strong></p>
<p>By completing this module, you've successfully set up Dynatrace OpenPipeline pipelines to process the Kubernetes Events logs at ingest.</p>
<ul>
<li>Kubernetes Events logs<ul>
<li>Enrich logs with additional Kubernetes metadata to unify telemetry signals and analyze Kubernetes context</li>
<li>Enrich the content field to fit logging standards and semantics</li>
<li>Set loglevel and status fields to easily identify errors with Kubernetes context</li>
<li>Remove unwanted fields/attributes to reduce log bloat and optimize queries</li>
<li>Add OpenTelemetry service name and namespace to unify telemetry signals and enable out-of-the-box analysis</li>
<li>Extract metrics: event count to track Kubernetes health and reduce heavy log queries</li>
<li>Routed logs to a specific bucket in Grail based on retention period needs</li>
</ul>
</li>
</ul>
<h2 id="continue">Continue<a class="headerlink" href="#continue" title="Permanent link">#</a></h2>
<div class="grid cards">
<ul>
<li><a href="../cleanup/">Continue to Clean Up<span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span></a></li>
</ul>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy"], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>