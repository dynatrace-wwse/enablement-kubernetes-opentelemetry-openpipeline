
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../6-dynatrace-openpipeline-collector-logs/">
      
      
        <link rel="next" href="../8-dynatrace-openpipeline-kubernetes-events/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.42">
    
    
      
        <title>7. Dynatrace OpenPipeline Astronomy Shop Logs - Dynatrace Enablement Lab: OpenTelemetry Logs and OpenPipeline</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
  <!-- Add scripts that need to run before here -->
  
      
    
  <!-- Add scripts that need to run afterwards here -->
   Create an agentless RUM application before GoLive
   <!-- TODO: BeforeGoLive: Replace Agentless RUM Snippet
    1. Create an agentless application in Dynatrace from with convention 'dynatrace-wwse/repositoryname'
    2. https://hci34192.apps.dynatrace.com/ui/apps/dynatrace.classic.deploy.agentless/#install/agentless;gtf=-2h;gf=all
    <script type="text/javascript" src="https://js-cdn.dynatrace.com/jstag/PLACEHOLDEr/REPLACE_WITH_YOUR_SNIPPET/1234abcd1234abcd_complete.js" crossorigin="anonymous"></script>
    -->
    <script type="text/javascript" src="https://js-cdn.dynatrace.com/jstag/145e12d594f/bf64904yne/6c910e7a6d2a6ab4_complete.js" crossorigin="anonymous"></script>

    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#dynatrace-openpipeline-astronomy-shop-logs" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Dynatrace Enablement Lab: OpenTelemetry Logs and OpenPipeline" class="md-header__button md-logo" aria-label="Dynatrace Enablement Lab: OpenTelemetry Logs and OpenPipeline" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Dynatrace Enablement Lab: OpenTelemetry Logs and OpenPipeline
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              7. Dynatrace OpenPipeline Astronomy Shop Logs
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/dynatrace-wwse/enablement-kubernetes-opentelemetry-openpipeline" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    View Code on GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Dynatrace Enablement Lab: OpenTelemetry Logs and OpenPipeline" class="md-nav__button md-logo" aria-label="Dynatrace Enablement Lab: OpenTelemetry Logs and OpenPipeline" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Dynatrace Enablement Lab: OpenTelemetry Logs and OpenPipeline
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/dynatrace-wwse/enablement-kubernetes-opentelemetry-openpipeline" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    View Code on GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. About
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../2-getting-started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Getting started
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../3-codespaces/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Codespaces
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../4-opentelemetry-logs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. OpenTelemetry Logs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../5-opentelemetry-capstone/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. OpenTelemetry Capstone
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../6-dynatrace-openpipeline-collector-logs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. Dynatrace OpenPipeline Collector Logs
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    7. Dynatrace OpenPipeline Astronomy Shop Logs
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    7. Dynatrace OpenPipeline Astronomy Shop Logs
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#query-logs" class="md-nav__link">
    <span class="md-ellipsis">
      Query Logs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Query Logs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#opentelemetry-service-name" class="md-nav__link">
    <span class="md-ellipsis">
      OpenTelemetry Service Name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opentelemetry-service-namespace" class="md-nav__link">
    <span class="md-ellipsis">
      OpenTelemetry Service Namespace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opentelemetry-sdk-logs" class="md-nav__link">
    <span class="md-ellipsis">
      OpenTelemetry SDK Logs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#java-technology-bundle" class="md-nav__link">
    <span class="md-ellipsis">
      Java Technology Bundle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#paymentservice-transactions" class="md-nav__link">
    <span class="md-ellipsis">
      PaymentService Transactions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-openpipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Configure OpenPipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configure OpenPipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#opentelemetry-service-name_1" class="md-nav__link">
    <span class="md-ellipsis">
      OpenTelemetry Service Name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opentelemetry-service-namespace_1" class="md-nav__link">
    <span class="md-ellipsis">
      OpenTelemetry Service Namespace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opentelemetry-sdk-logs_1" class="md-nav__link">
    <span class="md-ellipsis">
      OpenTelemetry SDK Logs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#java-technology-bundle_1" class="md-nav__link">
    <span class="md-ellipsis">
      Java Technology Bundle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#paymentservice-transactions_1" class="md-nav__link">
    <span class="md-ellipsis">
      PaymentService Transactions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#paymentservice-transaction-bizevent" class="md-nav__link">
    <span class="md-ellipsis">
      PaymentService Transaction BizEvent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#paymentservice-transaction-metric" class="md-nav__link">
    <span class="md-ellipsis">
      PaymentService Transaction Metric
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-route" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamic Route
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyze-results" class="md-nav__link">
    <span class="md-ellipsis">
      Analyze Results
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Analyze Results">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#analyze-the-results-in-dynatrace-notebook" class="md-nav__link">
    <span class="md-ellipsis">
      Analyze the results in Dynatrace (Notebook)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wrap-up" class="md-nav__link">
    <span class="md-ellipsis">
      Wrap Up
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#continue" class="md-nav__link">
    <span class="md-ellipsis">
      Continue
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../8-dynatrace-openpipeline-kubernetes-events/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8. Dynatrace OpenPipeline Kubernetes Events
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cleanup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9. Cleanup
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#query-logs" class="md-nav__link">
    <span class="md-ellipsis">
      Query Logs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Query Logs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#opentelemetry-service-name" class="md-nav__link">
    <span class="md-ellipsis">
      OpenTelemetry Service Name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opentelemetry-service-namespace" class="md-nav__link">
    <span class="md-ellipsis">
      OpenTelemetry Service Namespace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opentelemetry-sdk-logs" class="md-nav__link">
    <span class="md-ellipsis">
      OpenTelemetry SDK Logs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#java-technology-bundle" class="md-nav__link">
    <span class="md-ellipsis">
      Java Technology Bundle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#paymentservice-transactions" class="md-nav__link">
    <span class="md-ellipsis">
      PaymentService Transactions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-openpipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Configure OpenPipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configure OpenPipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#opentelemetry-service-name_1" class="md-nav__link">
    <span class="md-ellipsis">
      OpenTelemetry Service Name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opentelemetry-service-namespace_1" class="md-nav__link">
    <span class="md-ellipsis">
      OpenTelemetry Service Namespace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#opentelemetry-sdk-logs_1" class="md-nav__link">
    <span class="md-ellipsis">
      OpenTelemetry SDK Logs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#java-technology-bundle_1" class="md-nav__link">
    <span class="md-ellipsis">
      Java Technology Bundle
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#paymentservice-transactions_1" class="md-nav__link">
    <span class="md-ellipsis">
      PaymentService Transactions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#paymentservice-transaction-bizevent" class="md-nav__link">
    <span class="md-ellipsis">
      PaymentService Transaction BizEvent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#paymentservice-transaction-metric" class="md-nav__link">
    <span class="md-ellipsis">
      PaymentService Transaction Metric
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-route" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamic Route
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyze-results" class="md-nav__link">
    <span class="md-ellipsis">
      Analyze Results
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Analyze Results">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#analyze-the-results-in-dynatrace-notebook" class="md-nav__link">
    <span class="md-ellipsis">
      Analyze the results in Dynatrace (Notebook)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wrap-up" class="md-nav__link">
    <span class="md-ellipsis">
      Wrap Up
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#continue" class="md-nav__link">
    <span class="md-ellipsis">
      Continue
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="dynatrace-openpipeline-astronomy-shop-logs">Dynatrace OpenPipeline - Astronomy Shop Logs<a class="headerlink" href="#dynatrace-openpipeline-astronomy-shop-logs" title="Permanent link">#</a></h1>
<script>
document.addEventListener('DOMContentLoaded', function() {
  dynatrace.sendBizEvent('page_load', {"page": "7. Dynatrace OpenPipeline Astronomy Shop Logs"})
});
</script>

<p>In this module we'll utilize Dynatrace OpenPipeline to process <code>astronomy-shop</code> application logs at ingest, in order to make them easier to analyze and leverage.  The logs will be ingested by OpenTelemetry Collector, deployed on Kubernetes as part of the previous module.  With OpenPipeline, the logs will be processed at ingest, to manipulate fields, extract metrics, and raise alert events in case of any issues.</p>
<p>The OpenTelemetry Collector deployed as a Daemonset is collecting Pod logs from the Node's filesystem and shipping them to Dynatrace.  The application Pods from the Astronomy Shop application have been instrumented with the OpenTelemetry SDK.  The OpenTelemetry SDK is configured to ship logs (,traces, and metrics) to Dynatrace via the OpenTelemetry Collector deployed as a Deployment (Gateway).  Due to the differences in how these logs are collected, they do not contain the same metadata.  While these logs contain a lot of useful information, they are missing valuable fields/attributes that will make them easier to analyze in context.  These logs can be enriched at ingest, using OpenPipeline.  Additionally, OpenPipeline allows us to process fields, extract new data types, manage permissions, and modify storage retention.</p>
<p><strong>Goals:</strong></p>
<ul>
<li>Add OpenTelemetry service name and namespace</li>
<li>Enrich SDK logs with additional Kubernetes metadata</li>
<li>Apply Dynatrace technology bundle (Java)</li>
<li>Extract data: Payment transaction business event</li>
<li>Extract metrics: Payment transaction amount</li>
</ul>
<p><img alt="OpenPipeline" src="../img/dt_opp_mrkt_header.png" /></p>
<p>OpenPipeline is an architectural component of Dynatrace SaaS.  It resides between the Dynatrace SaaS tenant and <a href="https://docs.dynatrace.com/docs/discover-dynatrace/platform/grail/dynatrace-grail">Grail</a> data lakehouse.  Logs (,traces, metrics, events, and more) are sent to the Dynatrace SaaS tenant and route through OpenPipeline where they are enriched, transformed, and contextualized prior to being stored in Grail.</p>
<div class="grid cards">
<ul>
<li><a href="https://docs.dynatrace.com/docs/discover-dynatrace/platform/openpipeline/concepts/data-flow" target="_blank">Learn More<span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span></a></li>
</ul>
</div>
<h2 id="query-logs">Query Logs<a class="headerlink" href="#query-logs" title="Permanent link">#</a></h2>
<p>Query and discover the Astronomy Shop logs as they are ingested and stored in Dynatrace.  Use Dynatrace Query Language (DQL) to transform the logs at query time and prepare for Dynatrace OpenPipeline configuration.</p>
<p><strong>Import Notebook into Dynatrace</strong></p>
<p><a href="https://github.com/dynatrace-wwse/enablement-kubernetes-opentelemetry-openpipeline/blob/main/assets/dynatrace/notebooks/astronomy-shop-logs.json" target="_blank">Download Astronomy Shop Logs Notebook</a></p>
<p><strong>Astronomy Shop Logs - Ondemand Processing at Query Time (Notebook)</strong></p>
<p>In OpenTelemetry, <code>service.name</code> and <code>service.namespace</code> are used to provide meaningful context about the services generating telemetry data:</p>
<p><code>service.name</code>: This is the logical name of the service. It should be the same for all instances of a horizontally scaled service. For example, if you have a shopping cart service, you might name it shoppingcart.</p>
<p><code>service.namespace</code>: This is used to group related services together. It helps distinguish a group of services that logically belong to the same system or team. For example, you might use Shop as the namespace for all services related to an online store.</p>
<p>These attributes help in organizing and identifying telemetry data, making it easier to monitor and troubleshoot services within a complex system.</p>
<p>The logs originating from the OpenTelemetry SDK contain both the <code>service.name</code> and <code>service.namespace</code>.  However, the Pod logs which contain stdout and stderr messages from the containers - do not.  In order to make it easier to analyze the log files and unify the telemetry, the <code>service.name</code> and <code>service.namespace</code> attributes should be added to the Pod logs with Dynatrace OpenPipeline.</p>
<h3 id="opentelemetry-service-name">OpenTelemetry Service Name<a class="headerlink" href="#opentelemetry-service-name" title="Permanent link">#</a></h3>
<p>Query the <code>astronomy-shop</code> logs fitered on <code>isNull(service.name)</code>.</p>
<p>DQL: Before OpenPipeline and DQL Transformation
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;astronomy-shop&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;opentelemetry&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="k">isNull</span><span class="p">(</span><span class="n">service</span><span class="p">.</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="n">app</span><span class="p">.</span><span class="n">label</span><span class="p">.</span><span class="n">component</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;astronomy-shop&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">filterOut</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;istio-proxy&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">25</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">label</span><span class="p">.</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="n">namespace</span>
</code></pre></div></p>
<p><img alt="Service Name Pre" src="../img/dt_opp-astronomy_shop_service_name_dql_pre.png" /></p>
<p>The value for <code>service.name</code> can be obtained from multiple different fields, but based on the application configuration - it is best to use the value from <code>app.label.component</code>.</p>
<p>Use DQL to transform the logs and apply the <code>service.name</code> value.</p>
<p>DQL: After DQL Transformation
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;astronomy-shop&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;opentelemetry&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="n">app</span><span class="p">.</span><span class="n">label</span><span class="p">.</span><span class="n">component</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;astronomy-shop&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">filterOut</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;istio-proxy&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">25</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsAdd</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">label</span><span class="p">.</span><span class="n">component</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">label</span><span class="p">.</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="n">namespace</span>
</code></pre></div></p>
<p><img alt="Service Name Post" src="../img/dt_opp-astronomy_shop_service_name_dql_post.png" /></p>
<p>This modifies the log attributes at query time and helps us identify the processing rules for Dynatrace OpenPipeline.  We'll validate the results after OpenPipeline, later.</p>
<h3 id="opentelemetry-service-namespace">OpenTelemetry Service Namespace<a class="headerlink" href="#opentelemetry-service-namespace" title="Permanent link">#</a></h3>
<p>Query the <code>astronomy-shop</code> logs fitered on <code>isNull(service.namespace)</code>.</p>
<p>DQL: Before OpenPipeline and DQL Transformation
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="k">isNull</span><span class="p">(</span><span class="n">service</span><span class="p">.</span><span class="n">namespace</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">isNull</span><span class="p">(</span><span class="n">service</span><span class="p">.</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="n">app</span><span class="p">.</span><span class="n">annotation</span><span class="p">.</span><span class="n">service</span><span class="p">.</span><span class="n">namespace</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;astronomy-shop&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">filterOut</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;istio-proxy&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">25</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsAdd</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">label</span><span class="p">.</span><span class="n">component</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">label</span><span class="p">.</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">annotation</span><span class="p">.</span><span class="n">service</span><span class="p">.</span><span class="n">namespace</span><span class="p">,</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="n">namespace</span>
</code></pre></div></p>
<p><img alt="Service Namespace Pre" src="../img/dt_opp-astronomy_shop_service_namespace_dql_pre.png" /></p>
<p>The Pods have been annotated with the service namespace.  The <code>k8sattributes</code> processor has been configured to add this annotation as an attribute, called <code>app.annotation.service.namespace</code>.  This field can be used to populate the <code>service.namespace</code>.</p>
<p>Use DQL to transform the logs and apply the <code>service.namespace</code> value.</p>
<p>DQL: After DQL Transformation
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="k">isNull</span><span class="p">(</span><span class="n">service</span><span class="p">.</span><span class="n">namespace</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="k">isNull</span><span class="p">(</span><span class="n">service</span><span class="p">.</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="n">app</span><span class="p">.</span><span class="n">annotation</span><span class="p">.</span><span class="n">service</span><span class="p">.</span><span class="n">namespace</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;astronomy-shop&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">filterOut</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;istio-proxy&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">25</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsAdd</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">label</span><span class="p">.</span><span class="n">component</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsAdd</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="n">namespace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">annotation</span><span class="p">.</span><span class="n">service</span><span class="p">.</span><span class="n">namespace</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">label</span><span class="p">.</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">annotation</span><span class="p">.</span><span class="n">service</span><span class="p">.</span><span class="n">namespace</span><span class="p">,</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="n">namespace</span>
</code></pre></div></p>
<p><img alt="Service Namespace Post" src="../img/dt_opp-astronomy_shop_service_namespace_dql_post.png" /></p>
<p>This modifies the log attributes at query time and helps us identify the processing rules for Dynatrace OpenPipeline.  We'll validate the results after OpenPipeline, later.</p>
<h3 id="opentelemetry-sdk-logs">OpenTelemetry SDK Logs<a class="headerlink" href="#opentelemetry-sdk-logs" title="Permanent link">#</a></h3>
<p>The logs generated and exported by the OpenTelemetry SDK are missing Kubernetes attributes, or in some cases have the wrong values set.  The OpenTelemetry SDK, unless specifically configured otherwise, is not aware of the Kubernetes context in which of the application runs.  As a result, when the OpenTelemetry Collector that's embedded in <code>astronomy-shop</code> sends the logs to the Dynatrace OpenTelemtry Collector via OTLP, the Kubernetes attributes are populated with the Kubernetes context of the <code>astronomy-shop-otelcol</code> workload.  This makes these attributes unreliable when analyzing logs.  In order to make it easier to analyze the log files and unify the telemetry, the Kubernetes attributes should be correct for the SDK logs with Dynatrace OpenPipeline.</p>
<p>Query the <code>astronomy-shop</code> logs filtered on <code>telemetry.sdk.language</code> and <code>astronomy-shop-otelcol</code>.</p>
<p>DQL: Before OpenPipeline and DQL Transformation
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="k">language</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;astronomy-shop-otelcol&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="n">service</span><span class="p">.</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;astronomy-shop&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">25</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="k">language</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">pod</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">pod</span><span class="p">.</span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">replicaset</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">node</span><span class="p">.</span><span class="n">name</span>
</code></pre></div></p>
<p><img alt="SDK Logs Pre" src="../img/dt_opp-astronomy_shop_sdk_logs_dql_pre.png" /></p>
<p>The <code>k8s.namespace.name</code> is correct, however the <code>k8s.deployment.name</code>, <code>k8s.pod.name</code>, <code>k8s.pod.uid</code>, <code>k8s.replicaset.name</code>, and <code>k8s.node.name</code> are incorrect.  Since the <code>k8s.deployment.name</code> is based on the <code>service.name</code>, this field can be used to correct the <code>k8s.deployment.name</code> value.  The other values can be set to <code>null</code> in order to avoid confusion with the <code>astronomy-shop-otelcol</code> workload.</p>
<p>Use DQL to transform the logs and set the <code>k8s.deployment.name</code> value while clearing the other fields.</p>
<p>DQL: After DQL Transformation
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="k">language</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;astronomy-shop-otelcol&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="n">service</span><span class="p">.</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;astronomy-shop&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">25</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsAdd</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">concat</span><span class="p">(</span><span class="ss">&quot;astronomy-shop-&quot;</span><span class="p">,</span><span class="n">service</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsAdd</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="n">name</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsAdd</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">label</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">concat</span><span class="p">(</span><span class="ss">&quot;astronomy-shop-&quot;</span><span class="p">,</span><span class="n">service</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsAdd</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">label</span><span class="p">.</span><span class="n">component</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="n">name</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsRemove</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">pod</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">pod</span><span class="p">.</span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">replicaset</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">node</span><span class="p">.</span><span class="n">name</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="k">language</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">label</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">label</span><span class="p">.</span><span class="n">component</span>
</code></pre></div></p>
<p><img alt="SDK Logs Post" src="../img/dt_opp-astronomy_shop_sdk_logs_dql_post.png" /></p>
<p>This modifies the log attributes at query time and helps us identify the processing rules for Dynatrace OpenPipeline.  We'll validate the results after OpenPipeline, later.</p>
<h3 id="java-technology-bundle">Java Technology Bundle<a class="headerlink" href="#java-technology-bundle" title="Permanent link">#</a></h3>
<p>Many applications written in a specific programming language will utilize known logging frameworks that have standard patterns, fields, and syntax for log messages.  For Java, these include frameworks such as Log4j, Logback, java.util.logging, etc.  Dynatrace OpenPipeline has a wide variety of Technology Processor Bundles, which can be easily added to a Pipeline to help format, clean up, and optimize logs for analysis.</p>
<p>The Java technology processor bundle can be applied to the <code>astronomy-shop</code> logs that we know are originating from Java applications.</p>
<p>Query the <code>astronomy-shop</code> logs filtered on <code>telemetry.sdk.language</code> or the <code>astronomy-shop-adservice</code> Java app.</p>
<p>DQL: Before OpenPipeline and DQL Transformation
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="n">matchesValue</span><span class="p">(</span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="k">language</span><span class="p">,</span><span class="ss">&quot;java&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">caseSensitive</span><span class="p">:</span><span class="w"> </span><span class="k">false</span><span class="p">)</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;astronomy-shop-adservice&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">caseSensitive</span><span class="p">:</span><span class="k">false</span><span class="p">))</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;astronomy-shop&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;astronomy-shop-adservice&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">caseSensitive</span><span class="p">:</span><span class="k">false</span><span class="p">)</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;astronomy-shop-kafka&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">caseSensitive</span><span class="p">:</span><span class="k">false</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">15</span>
<span class="o">|</span><span class="w"> </span><span class="n">append</span><span class="w"> </span><span class="p">[</span><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="k">language</span><span class="p">,</span><span class="ss">&quot;java&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">caseSensitive</span><span class="p">:</span><span class="w"> </span><span class="k">false</span><span class="p">)</span>
<span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">fieldsAdd</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">concat</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;-&quot;</span><span class="p">,</span><span class="n">service</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="w">          </span><span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">15</span><span class="p">]</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="k">language</span><span class="p">,</span><span class="w"> </span><span class="n">content</span>
</code></pre></div></p>
<p><img alt="Java Technology Bundle" src="../img/dt_opp-astronomy_shop_java_bundle_dql_pre.png" /></p>
<p>These are the logs that will be modified using the Java technology processor bundle within OpenPipeline.  We'll validate the results after OpenPipeline, later.</p>
<h3 id="paymentservice-transactions">PaymentService Transactions<a class="headerlink" href="#paymentservice-transactions" title="Permanent link">#</a></h3>
<p>Most (if not all) applications and microservices drive business processes and outcomes.  Details about the execution of these business processes is often written out to the logs by the application.  Dynatrace OpenPipeline is able to extract this business-relevant information as a business event (bizevent).</p>
<p><a href="https://docs.dynatrace.com/docs/shortlink/ba-business-events-capturing#logs" target="_blank">Log to Business Event Documentation</a></p>
<p>DQL is fast and powerful, allowing us to query log files and summarize the data to generate timeseries for dashboards, alerts, AI-driven forecasting and more.  While it's handy to generate timeseries metric data from logs when we didn't know we would need it, it's better to generate timeseries metric data from logs at ingest for the use cases that we know ahead of time.  Dynatrace OpenPipeline is able to extract metric data from logs on ingest.</p>
<p><a href="https://docs.dynatrace.com/docs/shortlink/openpipeline-log-processing" target="_blank">Log to Metric Documentation</a></p>
<p>The <code>paymentservice</code> component of <code>astronomy-shop</code> generates a log record every time it processes a payment transaction successfully.  This information is nested within a <code>JSON</code> structured log record, including the transactionId, amount, cardType, and currencyCode.  By parsing these relevant logs for the fields we need, Dynatrace OpenPipeline can be used to generate a payment transaction business event and a payment transaction amount metric on log record ingest.</p>
<p>Query the <code>astronomy-shop</code> logs filtered on the <code>paymentservice</code> logs with a <code>trace_id</code> attribute.</p>
<p>DQL: Before OpenPipeline and DQL Transformation
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;astronomy-shop&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;paymentservice&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="n">trace_id</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">25</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">trace_id</span>
</code></pre></div></p>
<p><img alt="PaymentService Pre" src="../img/dt_opp-astronomy_shop_paymentservice_dql_pre.png" /></p>
<p>The <code>content</code> field is structured <code>JSON</code>.  The parse command can be used to parse the JSON content and add the fields we need for our use case.</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;30&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;time&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1742928663142&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;pid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;24&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;hostname&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;astronomy-shop-paymentservice-6fb4c9ff9b-t45xn&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;trace_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;f3c6358fe776c7053d0fd2dab7bc470f&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;span_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;880430306f41a648&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;trace_flags&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;01&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;transactionId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;c54b6b4c-ebf1-4191-af21-5f583d0d0c87&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;cardType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;visa&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;lastFourDigits&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5647&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;amount&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;units&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;low&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;37548&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;high&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;unsigned&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;nanos&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;749999995&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;currencyCode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;USD&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;msg&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Transaction complete.&quot;</span>
<span class="p">}</span>
</code></pre></div>
<p>Use DQL to transform the logs and parse the payment fields from the JSON content.</p>
<p>DQL: After DQL Transformation
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;astronomy-shop&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;paymentservice&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="n">trace_id</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">25</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">trace_id</span>
<span class="o">|</span><span class="w"> </span><span class="n">parse</span><span class="w"> </span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;JSON:json_content&quot;</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsAdd</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">payment</span><span class="p">.</span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">json_content</span><span class="p">[</span><span class="o">`</span><span class="n">msg</span><span class="o">`</span><span class="p">]</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">payment</span><span class="p">.</span><span class="n">msg</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;Transaction complete.&quot;</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsAdd</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">payment</span><span class="p">.</span><span class="n">cardType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">json_content</span><span class="p">[</span><span class="o">`</span><span class="n">cardType</span><span class="o">`</span><span class="p">]</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsAdd</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">payment</span><span class="p">.</span><span class="n">amount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">json_content</span><span class="p">[</span><span class="o">`</span><span class="n">amount</span><span class="o">`</span><span class="p">][</span><span class="o">`</span><span class="n">units</span><span class="o">`</span><span class="p">][</span><span class="o">`</span><span class="n">low</span><span class="o">`</span><span class="p">]</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsAdd</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">payment</span><span class="p">.</span><span class="n">currencyCode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">json_content</span><span class="p">[</span><span class="o">`</span><span class="n">amount</span><span class="o">`</span><span class="p">][</span><span class="o">`</span><span class="n">currencyCode</span><span class="o">`</span><span class="p">]</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsAdd</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">payment</span><span class="p">.</span><span class="n">transactionId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">json_content</span><span class="p">[</span><span class="o">`</span><span class="n">transactionId</span><span class="o">`</span><span class="p">]</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsRemove</span><span class="w"> </span><span class="n">json_content</span>
</code></pre></div></p>
<p><img alt="PaymentService Post" src="../img/dt_opp-astronomy_shop_paymentservice_dql_post.png" /></p>
<p>This modifies the log attributes at query time and helps us identify the processing rules for Dynatrace OpenPipeline.  We'll validate the results after OpenPipeline, <em>next</em>.</p>
<h2 id="configure-openpipeline">Configure OpenPipeline<a class="headerlink" href="#configure-openpipeline" title="Permanent link">#</a></h2>
<p>Configure Dynatrace OpenPipeline for Astronomy Shop logs.</p>
<div class="admonition tip">
<p class="admonition-title">View Images</p>
<p>If the images are too small and the text is difficult to read, right-click and open the image in a new tab.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Save Often</p>
<p>Consider saving your pipeline configuration often to avoid losing any changes.</p>
</div>
<p>In your Dynatrace tenant, launch the OpenPipeline app.  Begin by selecting <code>Logs</code> from the left-hand menu of telemetry types.  Then choose <code>Pipelines</code>.  Click on <code>+ Pipeline</code> to add a new pipeline.</p>
<p><img alt="Add Pipeline" src="../img/dt_opp-astronomy_shop_opp_add_pipeline.png" /></p>
<p>Name the new pipeline, <code>Astronomy Shop OpenTelemetry Logs</code>.  Click on the <code>Processing</code> tab to begin adding <code>Processor</code> rules.</p>
<p><img alt="Name Pipeline" src="../img/dt_opp-astronomy_shop_opp_name_pipeline.png" /></p>
<h3 id="opentelemetry-service-name_1">OpenTelemetry Service Name<a class="headerlink" href="#opentelemetry-service-name_1" title="Permanent link">#</a></h3>
<p>Add a processor to set the OpenTelemetry Service Name.  Click on <code>+ Processor</code> to add a new processor.</p>
<p>Type:
<div class="highlight"><pre><span></span><code>DQL
</code></pre></div></p>
<p>Name:
<div class="highlight"><pre><span></span><code>OpenTelemetry Service Name
</code></pre></div></p>
<p>Matching condition:
<div class="highlight"><pre><span></span><code>isNull(service.name) and isNotNull(app.label.component) and matchesValue(k8s.namespace.name,&quot;astronomy-shop&quot;)
</code></pre></div></p>
<p>Processor definition:
<div class="highlight"><pre><span></span><code>fieldsAdd service.name = app.label.component
</code></pre></div></p>
<p><img alt="Service Name" src="../img/dt_opp-astronomy_shop_opp_dql_service_name.png" /></p>
<h3 id="opentelemetry-service-namespace_1">OpenTelemetry Service Namespace<a class="headerlink" href="#opentelemetry-service-namespace_1" title="Permanent link">#</a></h3>
<p>Add a processor to set the OpenTelemetry Service Namespace.  Click on <code>+ Processor</code> to add a new processor.</p>
<p>Type:
<div class="highlight"><pre><span></span><code>DQL
</code></pre></div></p>
<p>Name:
<div class="highlight"><pre><span></span><code>OpenTelemetry Service Namespace
</code></pre></div></p>
<p>Matching condition:
<div class="highlight"><pre><span></span><code>isNull(service.namespace) and isNotNull(service.name) and isNotNull(app.annotation.service.namespace) and matchesValue(k8s.namespace.name,&quot;astronomy-shop&quot;)
</code></pre></div></p>
<p>Processor definition:
<div class="highlight"><pre><span></span><code>fieldsAdd service.namespace = app.annotation.service.namespace
</code></pre></div></p>
<p><img alt="Service Namespace" src="../img/dt_opp-astronomy_shop_opp_dql_service_namespace.png" /></p>
<h3 id="opentelemetry-sdk-logs_1">OpenTelemetry SDK Logs<a class="headerlink" href="#opentelemetry-sdk-logs_1" title="Permanent link">#</a></h3>
<p>Add a processor to transform the OpenTelemetry SDK Logs.  Click on <code>+ Processor</code> to add a new processor.</p>
<p>Type:
<div class="highlight"><pre><span></span><code>DQL
</code></pre></div></p>
<p>Name:
<div class="highlight"><pre><span></span><code>OpenTelemetry SDK Logs
</code></pre></div></p>
<p>Matching condition:
<div class="highlight"><pre><span></span><code>isNotNull(telemetry.sdk.language) and matchesValue(k8s.deployment.name,&quot;astronomy-shop-otelcol&quot;) and isNotNull(service.name) and matchesValue(k8s.namespace.name,&quot;astronomy-shop&quot;)
</code></pre></div></p>
<p>Processor definition:
<div class="highlight"><pre><span></span><code>fieldsAdd k8s.deployment.name = concat(&quot;astronomy-shop-&quot;,service.name)
| fieldsAdd k8s.container.name = service.name
| fieldsAdd app.label.name = concat(&quot;astronomy-shop-&quot;,service.name)
| fieldsAdd app.label.component = service.name
| fieldsRemove k8s.pod.name, k8s.pod.uid, k8s.replicaset.name, k8s.node.name
</code></pre></div></p>
<p><img alt="SDK Logs" src="../img/dt_opp-astronomy_shop_opp_dql_otel_sdk.png" /></p>
<h3 id="java-technology-bundle_1">Java Technology Bundle<a class="headerlink" href="#java-technology-bundle_1" title="Permanent link">#</a></h3>
<p>Add a processor to enrich the Java logs using the Java Technology Bundle.  Click on <code>+ Processor</code> to add a new processor.</p>
<p>Type:
<div class="highlight"><pre><span></span><code>Technology Bundle &gt; Java
</code></pre></div></p>
<p>Matching condition:
<div class="highlight"><pre><span></span><code>(matchesValue(telemetry.sdk.language,&quot;java&quot;, caseSensitive: false) or matchesValue(k8s.deployment.name,&quot;astronomy-shop-adservice&quot;, caseSensitive:false)) and matchesValue(k8s.namespace.name,&quot;astronomy-shop&quot;)
</code></pre></div></p>
<p><img alt="Java Technology Bundle" src="../img/dt_opp-astronomy_shop_opp_dql_java_bundle.png" /></p>
<h3 id="paymentservice-transactions_1">PaymentService Transactions<a class="headerlink" href="#paymentservice-transactions_1" title="Permanent link">#</a></h3>
<p>Add a processor to parse the PaymentService Transaction logs.  Click on <code>+ Processor</code> to add a new processor.</p>
<p>Type:
<div class="highlight"><pre><span></span><code>DQL
</code></pre></div></p>
<p>Name:
<div class="highlight"><pre><span></span><code>PaymentService Transactions
</code></pre></div></p>
<p>Matching condition:
<div class="highlight"><pre><span></span><code>matchesValue(service.name,&quot;paymentservice&quot;) and matchesValue(k8s.container.name,&quot;paymentservice&quot;) and isNotNull(trace_id)
</code></pre></div></p>
<p>Processor definition:
<div class="highlight"><pre><span></span><code>parse content, &quot;JSON:json_content&quot;
| fieldsAdd app.payment.msg = json_content[`msg`]
| fieldsAdd app.payment.cardType = json_content[`cardType`]
| fieldsAdd app.payment.amount = json_content[`amount`][`units`][`low`]
| fieldsAdd app.payment.currencyCode = json_content[`amount`][`currencyCode`]
| fieldsAdd app.payment.transactionId = json_content[`transactionId`]
| fieldsRemove json_content
</code></pre></div></p>
<p><img alt="PaymentService Transactions" src="../img/dt_opp-astronomy_shop_opp_dql_paymentservice.png" /></p>
<div class="admonition tip">
<p class="admonition-title">Save Often</p>
<p>Consider saving your pipeline configuration often to avoid losing any changes.</p>
</div>
<h3 id="paymentservice-transaction-bizevent">PaymentService Transaction BizEvent<a class="headerlink" href="#paymentservice-transaction-bizevent" title="Permanent link">#</a></h3>
<p>Switch to the <code>Data extraction</code> tab.</p>
<p>Add a processor to extract a <code>Business Event</code>.  Click on <code>+ Processor</code> to add a new processor.</p>
<p>Type:
<div class="highlight"><pre><span></span><code>Business Event
</code></pre></div></p>
<p>Name:
<div class="highlight"><pre><span></span><code>PaymentService Transaction
</code></pre></div></p>
<p>Matching condition:
<div class="highlight"><pre><span></span><code>matchesValue(k8s.container.name,&quot;paymentservice&quot;) and isNotNull(app.payment.cardType) and isNotNull(app.payment.amount) and isNotNull(app.payment.currencyCode) and isNotNull(app.payment.transactionId)
</code></pre></div></p>
<p>Event type:
<div class="highlight"><pre><span></span><code>Static String : astronomy-shop.app.payment.complete
</code></pre></div></p>
<p>Event provider:
<div class="highlight"><pre><span></span><code>Static String: astronomy-shop.opentelemetry
</code></pre></div></p>
<p>Field Extraction:</p>
<table>
<thead>
<tr>
<th>Fields</th>
</tr>
</thead>
<tbody>
<tr>
<td>app.payment.msg</td>
</tr>
<tr>
<td>app.payment.cardType</td>
</tr>
<tr>
<td>app.payment.amount</td>
</tr>
<tr>
<td>app.payment.currencyCode</td>
</tr>
<tr>
<td>app.payment.transactionid</td>
</tr>
</tbody>
</table>
<p><img alt="PaymentService BizEvent" src="../img/dt_opp-astronomy_shop_opp_bizevent_payment.png" /></p>
<div class="admonition tip">
<p class="admonition-title">Save Often</p>
<p>Consider saving your pipeline configuration often to avoid losing any changes.</p>
</div>
<h3 id="paymentservice-transaction-metric">PaymentService Transaction Metric<a class="headerlink" href="#paymentservice-transaction-metric" title="Permanent link">#</a></h3>
<p>Switch to the <code>Metric Extraction</code> tab.</p>
<p>Add a processor to set extract a metric from the PaymentService Transaction logs.  Click on <code>+ Processor</code> to add a new processor.</p>
<p>Type:
<div class="highlight"><pre><span></span><code>Value metric
</code></pre></div></p>
<p>Name:
<div class="highlight"><pre><span></span><code>PaymentService Transaction
</code></pre></div></p>
<p>Matching condition:
<div class="highlight"><pre><span></span><code>matchesValue(k8s.container.name,&quot;paymentservice&quot;) and isNotNull(app.payment.cardType) and isNotNull(app.payment.amount) and isNotNull(app.payment.currencyCode) and isNotNull(app.payment.transactionId)
</code></pre></div></p>
<p>Field extraction:
<div class="highlight"><pre><span></span><code>app.payment.amount
</code></pre></div></p>
<p>Metric key:
<div class="highlight"><pre><span></span><code>otel.astronomy-shop.app.payment.amount
</code></pre></div></p>
<p>Dimensions:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Dimension</th>
</tr>
</thead>
<tbody>
<tr>
<td>app.payment.cardType</td>
<td>cardType</td>
</tr>
<tr>
<td>app.payment.currencyCode</td>
<td>currencyCode</td>
</tr>
</tbody>
</table>
<p><img alt="PaymentService Metric" src="../img/dt_opp-astronomy_shop_opp_metric_payment.png" /></p>
<p>The pipeline is now configured, click on <code>Save</code> to save the pipeline configuration.</p>
<p><img alt="Save Pipeline" src="../img/dt_opp-astronomy_shop_opp_save_pipeline.png" /></p>
<h3 id="dynamic-route">Dynamic Route<a class="headerlink" href="#dynamic-route" title="Permanent link">#</a></h3>
<p>A pipeline will not have any effect unless logs are configured to be routed to the pipeline.  With dynamic routing, data is routed based on a matching condition. The matching condition is a DQL query that defines the data set you want to route.</p>
<p>Click on <code>Dynamic Routing</code> to configure a route to the target pipeline.  Click on <code>+ Dynamic Route</code> to add a new route.</p>
<p><img alt="Add Route" src="../img/dt_opp-astronomy_shop_opp_add_route.png" /></p>
<p>Configure the <code>Dynamic Route</code> to use the <code>Astronomy Shop OpenTelemetry Logs</code> pipeline.</p>
<p>Name:
<div class="highlight"><pre><span></span><code>Astronomy Shop OpenTelemetry Logs
</code></pre></div></p>
<p>Matching condition:
<div class="highlight"><pre><span></span><code>matchesValue(k8s.namespace.name,&quot;astronomy-shop&quot;) and matchesValue(telemetry.sdk.name,&quot;opentelemetry&quot;) and isNull(event.domain)
</code></pre></div></p>
<p>Pipeline:
<div class="highlight"><pre><span></span><code>Astronomy Shop OpenTelemetry Logs
</code></pre></div></p>
<p>Click <code>Add</code> to add the route.</p>
<p><img alt="Configure Route" src="../img/dt_opp-astronomy_shop_opp_configure_route.png" /></p>
<p>Validate that the route is enabled in the <code>Status</code> column.  Click on <code>Save</code> to save the dynamic route table configuration.</p>
<p><img alt="Save Routes" src="../img/dt_opp-astronomy_shop_opp_save_routes.png" /></p>
<p>Allow <code>astronomy-shop</code> to generate new log data that will be routed through the new pipeline (3-5 minutes).</p>
<h2 id="analyze-results">Analyze Results<a class="headerlink" href="#analyze-results" title="Permanent link">#</a></h2>
<p>Analyze the Astronomy Shop logs after Dynatrace OpenPipeline processing.</p>
<h3 id="analyze-the-results-in-dynatrace-notebook">Analyze the results in Dynatrace (Notebook)<a class="headerlink" href="#analyze-the-results-in-dynatrace-notebook" title="Permanent link">#</a></h3>
<p>Use the Notebook from earlier to analyze the results.</p>
<p><strong>OpenTelemetry Service Name</strong></p>
<p>Query the <code>astronomy-shop</code> logs fitered on <code>isNotNull(service.name)</code> to analyze with <code>OpenTelemetry Service Name</code>.</p>
<p>DQL: After OpenPipeline
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;astronomy-shop&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;opentelemetry&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="n">service</span><span class="p">.</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="n">app</span><span class="p">.</span><span class="n">label</span><span class="p">.</span><span class="n">component</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;astronomy-shop&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">filterOut</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;istio-proxy&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">25</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">label</span><span class="p">.</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="n">namespace</span>
</code></pre></div></p>
<p><img alt="Service Name" src="../img/dt_opp-astronomy_shop_analyze_service_name.png" /></p>
<p><strong>OpenTelemetry Service Namespace</strong></p>
<p>Query the <code>astronomy-shop</code> logs fitered on <code>isNotNull(service.namespace)</code> to analyze with <code>OpenTelemetry Service Namespace</code>.</p>
<p>DQL: After OpenPipeline
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="n">service</span><span class="p">.</span><span class="n">namespace</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="n">service</span><span class="p">.</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="n">app</span><span class="p">.</span><span class="n">annotation</span><span class="p">.</span><span class="n">service</span><span class="p">.</span><span class="n">namespace</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;astronomy-shop&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">filterOut</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;istio-proxy&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">25</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">label</span><span class="p">.</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">annotation</span><span class="p">.</span><span class="n">service</span><span class="p">.</span><span class="n">namespace</span><span class="p">,</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="n">namespace</span>
</code></pre></div></p>
<p><img alt="Service Name" src="../img/dt_opp-astronomy_shop_analyze_service_namespace.png" /></p>
<p><strong>OpenTelemetry SDK Logs</strong></p>
<p>Query the <code>astronomy-shop</code> logs fitered on <code>telemetry.sdk.language</code> to analyze with <code>OpenTelemetry SDK Logs</code>.</p>
<p>DQL: After OpenPipeline
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="k">language</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="n">service</span><span class="p">.</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;astronomy-shop&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">25</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">service</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="k">language</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">label</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">label</span><span class="p">.</span><span class="n">component</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">pod</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">pod</span><span class="p">.</span><span class="n">uid</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">replicaset</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">node</span><span class="p">.</span><span class="n">name</span>
</code></pre></div></p>
<p><img alt="Service Name" src="../img/dt_opp-astronomy_shop_analyze_sdk_logs.png" /></p>
<p><strong>Java Technology Bundle</strong></p>
<p>Query the <code>astronomy-shop</code> logs fitered on <code>telemetry.sdk.language == "java"</code> to analyze with <code>Java Technology Bundle</code> logs.</p>
<p>DQL: After OpenPipeline
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="n">matchesValue</span><span class="p">(</span><span class="n">telemetry</span><span class="p">.</span><span class="n">sdk</span><span class="p">.</span><span class="k">language</span><span class="p">,</span><span class="ss">&quot;java&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">caseSensitive</span><span class="p">:</span><span class="w"> </span><span class="k">false</span><span class="p">)</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">deployment</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;astronomy-shop-adservice&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">caseSensitive</span><span class="p">:</span><span class="k">false</span><span class="p">))</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;astronomy-shop&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">filterOut</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;istio-proxy&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">50</span>
</code></pre></div></p>
<p><img alt="Service Name" src="../img/dt_opp-astronomy_shop_analyze_java_logs.png" /></p>
<p>You likely won't notice anything different about these logs.  This exercise was meant to show you how to use the technology bundles.</p>
<p><strong>PaymentService Transactions</strong></p>
<p>Query the <code>astronomy-shop</code> logs fitered on <code>service.name == "paymentservice"</code> to analyze with <code>PaymentService</code> logs.</p>
<p>DQL: After OpenPipeline
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">logs</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">namespace</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;astronomy-shop&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="n">service</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">filterOut</span><span class="w"> </span><span class="n">event</span><span class="p">.</span><span class="k">domain</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;k8s&quot;</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">service</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;paymentservice&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">k8s</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="ss">&quot;paymentservice&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">isNotNull</span><span class="p">(</span><span class="n">trace_id</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">25</span>
<span class="o">|</span><span class="w"> </span><span class="n">fields</span><span class="w"> </span><span class="k">timestamp</span><span class="p">,</span><span class="w"> </span><span class="n">content</span><span class="p">,</span><span class="w"> </span><span class="n">k8s</span><span class="p">.</span><span class="n">container</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">trace_id</span><span class="p">,</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">payment</span><span class="p">.</span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">payment</span><span class="p">.</span><span class="n">cardType</span><span class="p">,</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">payment</span><span class="p">.</span><span class="n">amount</span><span class="p">,</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">payment</span><span class="p">.</span><span class="n">currencyCode</span><span class="p">,</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="n">payment</span><span class="p">.</span><span class="n">transactionId</span>
</code></pre></div></p>
<p><img alt="Service Name" src="../img/dt_opp-astronomy_shop_analyze_paymentservice_logs.png" /></p>
<p>Query the <code>PaymentService</code> Business Events.</p>
<p>DQL: PaymentService Transaction Business Events
<div class="highlight"><pre><span></span><code><span class="k">fetch</span><span class="w"> </span><span class="n">bizevents</span>
<span class="o">|</span><span class="w"> </span><span class="n">filter</span><span class="w"> </span><span class="n">matchesValue</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="k">type</span><span class="p">,</span><span class="ss">&quot;astronomy-shop.app.payment.complete&quot;</span><span class="p">)</span>
<span class="o">|</span><span class="w"> </span><span class="n">sort</span><span class="w"> </span><span class="k">timestamp</span><span class="w"> </span><span class="k">desc</span>
<span class="o">|</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span>
</code></pre></div></p>
<p><img alt="Service Name" src="../img/dt_opp-astronomy_shop_analyze_paymentservice_bizevents.png" /></p>
<p>Query the <code>PaymentService</code> Metric.</p>
<p>DQL: PaymentService Transaction Extracted Metric
<div class="highlight"><pre><span></span><code><span class="n">timeseries</span><span class="w"> </span><span class="k">sum</span><span class="p">(</span><span class="o">`</span><span class="n">log</span><span class="p">.</span><span class="n">otel</span><span class="p">.</span><span class="n">astronomy</span><span class="o">-</span><span class="n">shop</span><span class="p">.</span><span class="n">app</span><span class="p">.</span><span class="n">payment</span><span class="p">.</span><span class="n">amount</span><span class="o">`</span><span class="p">),</span><span class="w"> </span><span class="k">by</span><span class="p">:</span><span class="w"> </span><span class="err">{</span><span class="w"> </span><span class="n">currencyCode</span><span class="p">,</span><span class="w"> </span><span class="n">cardType</span><span class="w"> </span><span class="err">}</span>
<span class="o">|</span><span class="w"> </span><span class="n">fieldsAdd</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arrayAvg</span><span class="p">(</span><span class="o">`</span><span class="k">sum</span><span class="p">(</span><span class="err">\</span><span class="o">`</span><span class="n">log</span><span class="p">.</span><span class="n">otel</span><span class="p">.</span><span class="n">astronomy</span><span class="o">-</span><span class="n">shop</span><span class="p">.</span><span class="n">app</span><span class="p">.</span><span class="n">payment</span><span class="p">.</span><span class="n">amount</span><span class="err">\</span><span class="o">`</span><span class="p">)</span><span class="o">`</span><span class="p">)</span>
</code></pre></div></p>
<p><img alt="Service Name" src="../img/dt_opp-astronomy_shop_analyze_paymentservice_metric.png" /></p>
<h2 id="wrap-up">Wrap Up<a class="headerlink" href="#wrap-up" title="Permanent link">#</a></h2>
<p><strong>What You Learned Today</strong></p>
<p>By completing this module, you've successfully set up Dynatrace OpenPipeline pipelines to process the Astronomy Shop logs at ingest.</p>
<ul>
<li>Astronomy Shop logs<ul>
<li>Add OpenTelemetry service name and namespace fields to unify telemetry signals and enable out-of-the-box analysis</li>
<li>Enrich SDK logs with additional Kubernetes metadata to unify telemetry signals and analyze Kubernetes context</li>
<li>Apply Dynatrace technology bundle (Java) to transform logs based on known Java standards and frameworks</li>
<li>Extract data: Payment transaction business event to measure business outcomes and link them to system health</li>
<li>Extract metrics: Payment transaction amount to measure business KPIs and link them to system health</li>
</ul>
</li>
</ul>
<h2 id="continue">Continue<a class="headerlink" href="#continue" title="Permanent link">#</a></h2>
<div class="grid cards">
<ul>
<li><a href="../8-dynatrace-openpipeline-kubernetes-events/">Continue to Configure Dynatrace OpenPipeline for Kubernetes Events<span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span></a></li>
</ul>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy"], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>